<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  <title>MongoDB Replication | junhee.ko</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="복제 (replication) 가 무엇인가요?여러 서버 상에서 데이터의 동일한 복사본을 유지하는 방법입니다. 복제의 장점은 무엇인가요?한 대 또는 그 이상의 서버에 이상이 발생하였을 때, 애플리케이션의 정상 동작 및 데이터를 안전하게 보존할 수 있습니다.  백업 역할 분리  MongoDB는 복제를 어떻게 하나요?복제 셋 (replica set) 을 생성함으">
<meta property="og:type" content="article">
<meta property="og:title" content="MongoDB Replication">
<meta property="og:url" content="https://kojunhee.github.io/2018/12/09/MongoDB Replication/index.html">
<meta property="og:site_name" content="junhee.ko">
<meta property="og:description" content="복제 (replication) 가 무엇인가요?여러 서버 상에서 데이터의 동일한 복사본을 유지하는 방법입니다. 복제의 장점은 무엇인가요?한 대 또는 그 이상의 서버에 이상이 발생하였을 때, 애플리케이션의 정상 동작 및 데이터를 안전하게 보존할 수 있습니다.  백업 역할 분리  MongoDB는 복제를 어떻게 하나요?복제 셋 (replica set) 을 생성함으">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-03-15T04:07:10.336Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="MongoDB Replication">
<meta name="twitter:description" content="복제 (replication) 가 무엇인가요?여러 서버 상에서 데이터의 동일한 복사본을 유지하는 방법입니다. 복제의 장점은 무엇인가요?한 대 또는 그 이상의 서버에 이상이 발생하였을 때, 애플리케이션의 정상 동작 및 데이터를 안전하게 보존할 수 있습니다.  백업 역할 분리  MongoDB는 복제를 어떻게 하나요?복제 셋 (replica set) 을 생성함으">
  
    <link rel="alternate" href="/atom.xml" title="junhee.ko" type="application/atom+xml">
  
  
    <link rel="icon" href="css/images/favicon.ico">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">junhee.ko</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">always learning</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://kojunhee.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-MongoDB Replication" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2018/12/09/MongoDB Replication/" class="article-date">
  <time class="dt-published" datetime="2018-12-08T15:00:00.000Z" itemprop="datePublished">2018-12-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/node-js/">Node.js</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      MongoDB Replication
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h5 id="복제-replication-가-무엇인가요"><a href="#복제-replication-가-무엇인가요" class="headerlink" title="복제 (replication) 가 무엇인가요?"></a>복제 (replication) 가 무엇인가요?</h5><p>여러 서버 상에서 데이터의 동일한 복사본을 유지하는 방법입니다.</p>
<h5 id="복제의-장점은-무엇인가요"><a href="#복제의-장점은-무엇인가요" class="headerlink" title="복제의 장점은 무엇인가요?"></a>복제의 장점은 무엇인가요?</h5><p>한 대 또는 그 이상의 서버에 이상이 발생하였을 때, 애플리케이션의 정상 동작 및 데이터를 안전하게 보존할 수 있습니다.</p>
<ol>
<li>백업</li>
<li>역할 분리</li>
</ol>
<h5 id="MongoDB는-복제를-어떻게-하나요"><a href="#MongoDB는-복제를-어떻게-하나요" class="headerlink" title="MongoDB는 복제를 어떻게 하나요?"></a>MongoDB는 복제를 어떻게 하나요?</h5><p>복제 셋 (replica set) 을 생성함으로써 복제를 할 수 있습니다.</p>
<h5 id="master-slave-복제는-없나요"><a href="#master-slave-복제는-없나요" class="headerlink" title="master-slave 복제는 없나요?"></a>master-slave 복제는 없나요?</h5><p>MongoDB 4.0 에서 master-slave replication 에 대한 지원을 제거했습니다.</p>
<h5 id="replica-set은-어떻게-구성되나요"><a href="#replica-set은-어떻게-구성되나요" class="headerlink" title="replica set은 어떻게 구성되나요?"></a>replica set은 어떻게 구성되나요?</h5><p>1대의 primary 서버와 여러 대의 secondary 서버로 구성합니다.</p>
<h5 id="primary-server의-특징은"><a href="#primary-server의-특징은" class="headerlink" title="primary server의 특징은?"></a>primary server의 특징은?</h5><p>클라이언트의 요청을 처리합니다. 데이터에 대한 read, write 모두 가능합니다.</p>
<h5 id="secondary-server의-특징은"><a href="#secondary-server의-특징은" class="headerlink" title="secondary server의 특징은?"></a>secondary server의 특징은?</h5><p>프라이머리 데이터의 복제 데이터를 가집니다. 프라이머리의 oplog 에서 하던 동작을 세컨더리의 데이터 셋에 비동기적으로 적용합니다. 프라이머리 서버에 장애가 발생시 세컨더리 서버는 자신들 중 새로운 프라이머리 서버를 선출할 수 있습니다. 데이터의 읽기만 가능합니다.</p>
<h5 id="데이터-복제는-어떻게-진행되나요"><a href="#데이터-복제는-어떻게-진행되나요" class="headerlink" title="데이터 복제는 어떻게 진행되나요?"></a>데이터 복제는 어떻게 진행되나요?</h5><p>세컨더리는 롱 폴링(long polling) 방식을 사용하여 프라이머리의 변경 데이터를 즉각적으로 적용합니다.</p>
<ol>
<li>클라이언트가 프라이머리 노드에 대해 쓰기를 할 때마다, 세컨더리에서 재생하기 위한 충분한 정보가 프라이머리 노드의 oplog에 자동으로 추가됩니다.</li>
<li>세컨더리 노드는 자신의 오프로그에서 가장 최근 항목의 timestamp를 검사합니다.</li>
<li>세컨더리 노드는 프라이머리 노드의 오피로그에서 최근 항목의 timestamp 이후의 모든 oplog 항목을 질의합니다.</li>
<li>질의된 oplog 항목을 자신의 oplog에 추가합니다.</li>
<li>추가된 oplog의 항목을 자신의 데이터에 적용합니다.</li>
</ol>
<h5 id="oplog가-무엇인가요"><a href="#oplog가-무엇인가요" class="headerlink" title="oplog가 무엇인가요?"></a>oplog가 무엇인가요?</h5><p>캡드(capped) 컬렉션으로, 모든 복제 노드에서 local 이라는 데이터베이스 내에 존재합니다.</p>
<h5 id="capped-collection-이란"><a href="#capped-collection-이란" class="headerlink" title="capped collection 이란?"></a>capped collection 이란?</h5><p>고정된 크기(fixed size) 를 가진 컬렉션입니다. circular buffer와 비슷하게 동작합니다. 할당된 공간을 모두 채우면, 가장 오래된 document 를 덮어씁니다.</p>
<h5 id="MongoDB가-건강상태를-확인하는-방법은-무엇인가요"><a href="#MongoDB가-건강상태를-확인하는-방법은-무엇인가요" class="headerlink" title="MongoDB가 건강상태를 확인하는 방법은 무엇인가요?"></a>MongoDB가 건강상태를 확인하는 방법은 무엇인가요?</h5><p>하트비트(heartbeat)를 합니다. 복제 셋의 각 멤버는 디폴트로 다른 멤버들을 매 2초마다 한 번씩 핑 (ping) 을 해봄으로써, 시스템의 건강 상태를 확인할 수 있습니다. 모든 모드가 건강한 상태일때만 복제 셋이 정상 동작하는 것이며 한 노드라도 반응이 없으면 조치를 취해야 합니다.</p>
<h5 id="장애가-발생했을-때-어떻게-하나요"><a href="#장애가-발생했을-때-어떻게-하나요" class="headerlink" title="장애가 발생했을 때 어떻게 하나요?"></a>장애가 발생했을 때 어떻게 하나요?</h5><p>장애 발생시 새로운 프라이머리를 선출해야 합니다. 투표를 위해서는 과반수 이상이 필요합니다. 과반수란 복제 셋의 모든 멤버의 절반보다 많은 것입니다. 예를 들어, </p>
<p>복제 셋의 멤버 수가 1 이면 복제 셋의 과반수는 1<br>복제 셋의 멤버 수가 2 이면 복제 셋의 과반수는 2<br>복제 셋의 멤버 수가 3 이면 복제 셋의 과반수는 2<br>복제 셋의 멤버 수가 4 이면 복제 셋의 과반수는 3<br>복제 셋의 멤버 수가 5 이면 복제 셋의 과반수는 3</p>
<h5 id="Arbiter란"><a href="#Arbiter란" class="headerlink" title="Arbiter란?"></a>Arbiter란?</h5><p>데이터의 복제에는 참여하지 않지만 프라이머리 선출에만 참여하는 중재자입니다. 프라이머리 1대와 세컨더리 1대로 이뤄진 복제 셋의 과반수는 2인데 프라이머리의 장애시 투표를 행사할 수 있는 서버는 1대 뿐이므로 프라이머리를 선출할 수 없습니다. 그래서 arbiter가 필요합니다.</p>
<h5 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h5><p><a href="http://kwsstudy.github.io/post/%EB%B3%B5%EC%A0%9C/" target="_blank" rel="noopener">http://kwsstudy.github.io/post/%EB%B3%B5%EC%A0%9C/</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kojunhee.github.io/2018/12/09/MongoDB Replication/" data-id="ck7vvtrwz00lam46wf8nop9f9" data-title="MongoDB Replication" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/12/09/REPL/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          REPL
        
      </div>
    </a>
  
  
    <a href="/2018/12/09/Docker/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Docker</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/big-data/">Big Data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/boost-course/">Boost Course</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/dip/">DIP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/data-structure/">Data Structure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">Database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/design-pattern/">Design Pattern</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jpa/">JPA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">Kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">Network</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">Node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/os/">OS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/object/">Object</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-engineering/">Software Engineering</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">Spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tdd/">TDD</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/etc/">etc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ios/">iOS</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/03/17/tdd-chapter-17/">[테스트 주도 개발] 17장_Money 회고</a>
          </li>
        
          <li>
            <a href="/2020/03/16/tdd-chapter-13/">[테스트 주도 개발] 13장_진짜로 만들기</a>
          </li>
        
          <li>
            <a href="/2020/03/16/tdd-chapter-15/">[테스트 주도 개발] 15장_서로 다른 통화 더하기</a>
          </li>
        
          <li>
            <a href="/2020/03/16/tdd-chapter-16/">[테스트 주도 개발] 16장_드디어, 추상화</a>
          </li>
        
          <li>
            <a href="/2020/03/16/tdd-chapter-14/">[테스트 주도 개발] 14장_바꾸기</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 junhee.ko<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="/js/jquery-3.4.1.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>