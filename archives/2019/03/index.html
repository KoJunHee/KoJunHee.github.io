
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="junhee.ko">
    <title>Archives: 2019/3 - junhee.ko</title>
    <meta name="author" content="junhee.ko">
    
    
    
    <script type="application/ld+json">{}</script>
    <meta name="description" content="always learning">
<meta property="og:type" content="blog">
<meta property="og:title" content="junhee.ko">
<meta property="og:url" content="https://kojunhee.github.io/archives/2019/03/index.html">
<meta property="og:site_name" content="junhee.ko">
<meta property="og:description" content="always learning">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="junhee.ko">
<meta name="twitter:description" content="always learning">
    
    
        
    
    
        <meta property="og:image" content="https://kojunhee.github.io/assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">junhee.ko</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">junhee.ko</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Always Learning</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/kojunhee" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://facebook.com/kojunheee" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/junheeko" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:junheee.ko@gmail.com" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
    <section class="postShorten-group main-content-wrap">
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2019/03/27/relation-mappings/">
                            [자바 ORM 표준 JPA 프로그래밍] 6장_다양한 연관관계 매핑
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-03-27T00:00:00+09:00">
	
		    Mar 27, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/jpa/">JPA</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>이번 포스팅에서는 다양한 연관관계를 다룹니다. 엔티티의 연관 관계를 매핑 할 때는 다음 세 가지를 고려해야합니다.</p>
<ul>
<li>다중성<ul>
<li>다대일</li>
<li>일대다</li>
<li>일대일</li>
<li>다대다</li>
</ul>
</li>
<li>단방향, 양방향<ul>
<li>테이블에는 방향이라는 개념이 없습니다.</li>
<li>객체는 참조용 필드를 가지고 있는 객체만 연관된 객체를 조회할 수 있습니다.</li>
</ul>
</li>
<li>연관관계의 주인<ul>
<li>데이터베이스는 외래 키 하나로 두 데이블이 연관관계 맺습니다.</li>
<li>엔티티를 양방향으로 매핑하면 A-&gt;B, B-&gt;A 2곳에서 서로를 참조하기 때문에, 객체의 연관관계를 관리하는 포인트는 2곳입니다. 따라서, 두 객체 연관관계 중 하나를 정해서 데이터베이스 외래 키를 관리해야합니다.</li>
</ul>
</li>
</ul>
<h4 id="1-다대일"><a href="#1-다대일" class="headerlink" title="1. 다대일"></a>1. 다대일</h4><p>데이터베이스 테이블의 일, 다 관계에서 외래 키는 항상 다쪽에 있습니다. 따라서, 객체 양방향 관계에서 연관관계의 주인은 항상 다쪽입니다.</p>
<h5 id="1-1-다대일-단방향"><a href="#1-1-다대일-단방향" class="headerlink" title="1.1 다대일 단방향"></a>1.1 다대일 단방향</h5><p> 회원은 팀 엔티티를 참조 가능합니다. 팀은 회원 참조하는 필드가 없습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ManyToOne</span></span><br><span class="line">  <span class="meta">@JoinColum</span> (name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Team team;	</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Getter, Setter ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Getter, Setter ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="1-1-다대일-양방향"><a href="#1-1-다대일-양방향" class="headerlink" title="1.1 다대일 양방향"></a>1.1 다대일 양방향</h5><p>양방향 연관관계는 항상 서로 참조해야합니다. 서로 참조하게 하려면 연관관계 편의 메소드를 작성하는게 좋습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ManyToOne</span></span><br><span class="line">  <span class="meta">@JoinColum</span> (name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Team team;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.team = team;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//무한 루프에 빠지지 않도록 체크</span></span><br><span class="line">    <span class="keyword">if</span>(!team.getMembers().contains(<span class="keyword">this</span>))&#123;</span><br><span class="line">      team.getMembers().add(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToMany</span> (mappedBy = <span class="string">"team"</span>)</span><br><span class="line">  <span class="keyword">private</span> List&lt;Member&gt; members = <span class="keyword">new</span> ArrayList&lt;Member&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addMember</span><span class="params">(Member member)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.members.add(member);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//무한 루프에 빠지지 않도록 체크</span></span><br><span class="line">    <span class="keyword">if</span>(member.getTeam() != <span class="keyword">this</span>)&#123;</span><br><span class="line">      member.setTeam(<span class="keyword">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Getter, Setter ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-일대다"><a href="#2-일대다" class="headerlink" title="2. 일대다"></a>2. 일대다</h4><h5 id="일대다-단방향"><a href="#일대다-단방향" class="headerlink" title="일대다 단방향"></a>일대다 단방향</h5><p>일대다 단방향은 약간 특이합니다. 일대다 관계에서, 외래 키는 항상 다쪽 테이블에 있습니다. 하지만 다 쪽인 Memebr 엔티티에는 외래 키를 매핑할 수 있는 참조 필드가 없습니다. 대신에, Team 엔티티에는 참조 필드인 members 가 있습니다. 따라서 반대편 테이블의 외래키를 관리하는 특이한 모습이 나타납니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToMany</span></span><br><span class="line">  <span class="meta">@JoinColum</span> (name = <span class="string">"TEAM_ID"</span>) <span class="comment">//MEMBER 테이블의 TEAM_ID (FK)</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;Member&gt; members = <span class="keyword">new</span> ArrayList&lt;Member&gt;();</span><br><span class="line">   </span><br><span class="line">  <span class="comment">//Getter, Setter ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Getter, Setter</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>일대다 단방향 매핑의 단점<ul>
<li>매핑한 객체가 관리하는 외래 키가 다른 테이블에 있다는 점입니다.</li>
<li>연관관계 처리를 위한 UPDATE SQL 을 추가로 실행해야합니다.</li>
<li>다음 코드에서, Member 엔티티는 Team 엔티티를 모릅니다. 따라서 Member 엔티티를 저장할 때는 Member 테이블의 TEAM_ID 외래키에 아무 값도 저장되지 않습니다. 대신, Team 엔티티를 저장할 때 Team.members 의 참조 값을 확인해서 회원 테이블에 있는 TEAM_ID 외래 키를 업데이트 합니다.</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSave</span><span class="params">()</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  Member member1 = <span class="keyword">new</span> Member(<span class="string">"member1"</span>);</span><br><span class="line">  Member member2 = <span class="keyword">new</span> Member(<span class="string">"member2"</span>);</span><br><span class="line">  </span><br><span class="line">  Team team1 = <span class="keyword">new</span> Team(<span class="string">"team1"</span>);</span><br><span class="line">  team1.getMembers().add(member1);</span><br><span class="line">  team1.getMembers().add(member2);</span><br><span class="line">  </span><br><span class="line">  em.persist(member1); <span class="comment">//INSERT-member1</span></span><br><span class="line">  em.persist(member2); <span class="comment">//INSERT-member2</span></span><br><span class="line">  em.persist(team1);   <span class="comment">//INSERT-team1, UPDATE-member.fk, UPDATE-member2.fk</span></span><br><span class="line">  </span><br><span class="line">  transaction.commit();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>따라서, 일대다 단방향 매핑보다는 다대일 양방향 매핑을 권장합니다.</p>
<h5 id="일대다-양방향"><a href="#일대다-양방향" class="headerlink" title="일대다 양방향"></a>일대다 양방향</h5><p>둘 다 같은 키를 관리하므로 문제가 발생할 수 있습니다. 따라서, 반대편인 다대일 쪽은 insertable =false, update = false 를 설정해서 읽기만 가능하게 합니다. 되록, 다대일 양방향 매핑을 사용해야합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToMany</span></span><br><span class="line">  <span class="meta">@JoinColum</span> (name = <span class="string">"TEAM_ID"</span>) </span><br><span class="line">  <span class="keyword">private</span> List&lt;Member&gt; members = <span class="keyword">new</span> ArrayList&lt;Member&gt;();</span><br><span class="line">   </span><br><span class="line">  <span class="comment">//Getter, Setter ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ManyToOne</span></span><br><span class="line">  <span class="meta">@JoinColumn</span>( name = <span class="string">"TEAM_ID"</span>, insertable =<span class="keyword">false</span>, update = <span class="keyword">false</span>)</span><br><span class="line">  <span class="keyword">private</span> Team team;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">//Getter, Setter ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="3-일대일"><a href="#3-일대일" class="headerlink" title="3. 일대일"></a>3. 일대일</h4><p>일대일 관계는 주 테이블이나 대상 테이블 중에 누가 외래키를 가질지 선택해야합니다.</p>
<h5 id="3-1-주-테이블에-외래-키"><a href="#3-1-주-테이블에-외래-키" class="headerlink" title="3.1 주 테이블에 외래 키"></a>3.1 주 테이블에 외래 키</h5><p>객체지향 개발자들은 주 테이블에 외래 키가 있는 것을 선호합니다. </p>
<ul>
<li>단방향</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToOne</span></span><br><span class="line">  <span class="meta">@JoinColumn</span>( name = <span class="string">"LOCKER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Locker locker;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Locker</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"LOCKER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>양방향</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToOne</span></span><br><span class="line">  <span class="meta">@JoinColumn</span>( name = <span class="string">"LOCKER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Locker locker;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Locker</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"LOCKER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToOne</span> (mappedBy =<span class="string">"locker"</span>)</span><br><span class="line">  <span class="keyword">private</span> Member member;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="3-2-대상-테이블에-외래-키"><a href="#3-2-대상-테이블에-외래-키" class="headerlink" title="3.2 대상 테이블에 외래 키"></a>3.2 대상 테이블에 외래 키</h5><ul>
<li>단방향<ul>
<li>일대일 관계 중 대상 테이블에 외래 키가 있는 단방향 관계는 JPA 에서 지원하지 않습니다.</li>
</ul>
</li>
<li>양방향</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToOne</span> (mappedBy =<span class="string">"member"</span>)</span><br><span class="line">  <span class="keyword">private</span> Locker locker;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Locker</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"LOCKER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@OneToOne</span> </span><br><span class="line">  <span class="meta">@JoinColumn</span>(name =<span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Member member;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-다대다"><a href="#4-다대다" class="headerlink" title="4. 다대다"></a>4. 다대다</h4><p>관계형 데이터베이스는 정규화된 테이블 2개를 다대다 관계로 표현할 수 없습니다. 그래서 일대다, 다대일 관계로 풀어내는 연결 테이블을 사용합니다. 그런데 객체는 테이블과 다르게 객체 2개로 다대다 관계를 만들 수 있습니다.</p>
<h5 id="4-1-다대다-단방향"><a href="#4-1-다대다-단방향" class="headerlink" title="4.1 다대다 단방향"></a>4.1 다대다 단방향</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@Column</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String username;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ManyToMany</span></span><br><span class="line">  <span class="meta">@JoinTable</span>(name = <span class="string">"MEMBER_PRODUCT"</span>, joinColums = <span class="meta">@JoinColumn</span> (name = <span class="string">"MEMBER_ID"</span>),</span><br><span class="line">            inverseJoinColums = <span class="meta">@JoinColumn</span>(name = <span class="string">"PRODUCT_ID"</span>))</span><br><span class="line">  <span class="keyword">private</span> List&lt;Product&gt; products = <span class="keyword">new</span> Arraylist&lt;List&gt;();</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@Column</span> (name = <span class="string">"PRODUCT_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>다음은 다대다 관계를 저장하는 예제입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line"> </span><br><span class="line">  Product productA = <span class="keyword">new</span> Product();</span><br><span class="line">  productA.setId(<span class="string">"productA"</span>);</span><br><span class="line">  productA.setName(<span class="string">"상품A"</span>);</span><br><span class="line">  em.persist(productA);</span><br><span class="line">  </span><br><span class="line">  Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">  member1.setId(<span class="string">"member1"</span>);</span><br><span class="line">  member1.setUsername(<span class="string">"회원1"</span>);</span><br><span class="line">  member.getProducts.add(productA);	<span class="comment">//연관관계 설정</span></span><br><span class="line">  em.persist(member1);</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>이 코드를 실행하면 다음 SQL이 실행됩니다.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> PRODUCT...</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> MEMBER...</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> MEMBER_PRODUCT...</span><br></pre></td></tr></table></figure>

<p>다음은 다대다 관계를 탐색하는 예제입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">find</span><span class="params">()</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  Member member = em.find(Member.class, <span class="string">"member1"</span>);</span><br><span class="line"> 	List&lt;Product&gt; products = member.getProducts(); <span class="comment">//객체 그래프 탐색</span></span><br><span class="line">  <span class="keyword">for</span> (Product product : products)&#123;</span><br><span class="line">    System.out.println(<span class="string">"product.name = "</span> + product.getName());</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>member.getProducts() 를 호출해서 상품 이름을 출력하면 다음 SQL이 실행됩니다.</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> MEMBER_PRODUCT MP</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> PRODUCT P <span class="keyword">ON</span> MP&gt;PRODUCT_ID = P.PRODUCT_ID</span><br><span class="line">WHER MP.MEMBER_ID = ?</span><br></pre></td></tr></table></figure>

<h5 id="4-2-다대다-양방향"><a href="#4-2-다대다-양방향" class="headerlink" title="4.2 다대다 양방향"></a>4.2 다대다 양방향</h5><p>양쪽 중 원하는 곳에 mappedBy 로 연관관계의 주인을 지정합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> </span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ManyTomany</span> (mappedBy = <span class="string">"products"</span>) <span class="comment">//역방향 추가</span></span><br><span class="line">  <span class="keyword">private</span> List&lt;Member&gt; members;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>다대다의 양방향 연관관계는 다음처럼 설정합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">member.getProducts().add(product);</span><br><span class="line">product.getMembers().add(member);</span><br></pre></td></tr></table></figure>

<p>회원 엔티티에 다음 편의 메소드를 추가합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addProduct</span><span class="params">(Product product)</span></span>&#123;</span><br><span class="line">  ...</span><br><span class="line">  products.add(product);</span><br><span class="line">  product.getMembers.add(<span class="keyword">this</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>역방향 탐색은 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">findInverse</span><span class="params">()</span></span>&#123;</span><br><span class="line">  Product product = em.find(Product.class, <span class="string">"productA"</span>);</span><br><span class="line">  List &lt;Member&gt; members = product.getMembers();</span><br><span class="line">  <span class="keyword">for</span> (Member member : members)&#123;</span><br><span class="line">    System.out.println(<span class="string">"member : "</span> + member.getUsername);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-3-다대다-매핑의-한계와-극복-연결-엔티티-사용"><a href="#4-3-다대다-매핑의-한계와-극복-연결-엔티티-사용" class="headerlink" title="4.3 다대다: 매핑의 한계와 극복, 연결 엔티티 사용"></a>4.3 다대다: 매핑의 한계와 극복, 연결 엔티티 사용</h5><p>연결테이블에 컬럼을 추가하면, 더이상 @ManyToMany를 사용할 수 없습니다. 주문 엔티티나 상품 엔티티에는 추가한 칼럼들을 매핑할 수 없기 때문입니다. 따라서, 연결 엔티티를 만들고 이곳에 추가한 칼럼들을 매핑해야합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@Column</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id;</span><br><span class="line">    </span><br><span class="line">  <span class="comment">//역방향</span></span><br><span class="line">  <span class="meta">@OneToMany</span> (mappedBy = <span class="string">"member"</span>)</span><br><span class="line">  <span class="keyword">private</span> List&lt;MemberProduct&gt; memberProducts;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Product</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@Column</span>(name = <span class="string">"PRODUCT_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> String id;</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">private</span> String name;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@IdClass</span> (MemberProductId.class) <span class="comment">//복합 기본키를 매핑</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberProduct</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 기본키 + 외래키</span></span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@ManyToOne</span></span><br><span class="line">  <span class="meta">@JoinColumn</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Member member; <span class="comment">//MemberProductId.product 와 연결</span></span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span></span><br><span class="line">  <span class="meta">@ManyToOne</span></span><br><span class="line">  <span class="meta">@JoinColumn</span> (name = <span class="string">"PRODUCT_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Product product; <span class="comment">//MemberProductId.product 와 연결</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> orderAmout;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 복합 키를 위한 식별자 클래스</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MemberProductId</span> <span class="keyword">implements</span> <span class="title">Serializable</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> String member; <span class="comment">//MemberProduct.member 와 연결</span></span><br><span class="line">  <span class="keyword">private</span> String product; <span class="comment">//MemberProduct.product 와 연결</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//hashCode cand equals ...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-4-다대다-새로운-키본-키-사용"><a href="#4-4-다대다-새로운-키본-키-사용" class="headerlink" title="4.4 다대다: 새로운 키본 키 사용"></a>4.4 다대다: 새로운 키본 키 사용</h5><p>추천하는 기본 키 생성 전략은 데이터베이스에서 자동으로 생성해주는 대리 키를 Long 값으로 사용하는 것입니다. </p>
<p>다음은, 연결 테이블에 새로운 기본키를 사용합니다. MemberProduct 보다 Order 이라는 이름으로 합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Order</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@Id</span> <span class="meta">@GeneratedValue</span></span><br><span class="line">  <span class="meta">@Column</span> (name = <span class="string">"ORDER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Long id; </span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ManyToOne</span></span><br><span class="line">  <span class="meta">@JoinColumn</span> (name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Member member;</span><br><span class="line">  </span><br><span class="line">  <span class="meta">@ManyToOne</span></span><br><span class="line">  <span class="meta">@JoinColumn</span> (name = <span class="string">"PRODUCT_ID"</span>)</span><br><span class="line">  <span class="keyword">private</span> Product product;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> <span class="keyword">int</span> orderAmout;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="4-5-다대다-연관관계-정리"><a href="#4-5-다대다-연관관계-정리" class="headerlink" title="4.5 다대다 연관관계 정리"></a>4.5 다대다 연관관계 정리</h5><p>다대다 관계를 일대다, 다대일 관계로 풀어내기 위해 연결 테이블을 만들 때, 식별자 구성 방법은 다음 두 가지가 있습니다.</p>
<ul>
<li>식별관계<ul>
<li>받아온 식별자를 기본키 + 외래키로 사용</li>
<li>데이터베이스에서는 이를 식별 관계라고 합니다.</li>
</ul>
</li>
<li>비식별 관계<ul>
<li>받아온 식별자는 외래키로만 사용하고 새로운 식별자를 추가</li>
<li>데이터베이스에서는 이를 비식별 관계라고 합니다.</li>
<li>이걸 추천합니다.</li>
</ul>
</li>
</ul>

                    
                        

                    
                    
                        <p>
                            <a href="/2019/03/27/relation-mappings/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2019/03/26/basic-relation-mapping/">
                            [자바 ORM 표준 JPA 프로그래밍] 5장_연관관계 매핑 기초
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-03-26T00:00:00+09:00">
	
		    Mar 26, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/jpa/">JPA</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>이번 포스팅에서는 객체의 참조와 테이블의 외래키를 매핑하는 것을 다룹니다. </p>
<h4 id="1-단방향-연관관계"><a href="#1-단방향-연관관계" class="headerlink" title="1. 단방향 연관관계"></a>1. 단방향 연관관계</h4><p>회원과 팀의 다대일 단방향 관계 (맴버-&gt;팀) 를 생각해봅시다.</p>
<ul>
<li>객체 연관 관계<ul>
<li>회원은 Member.team 필드를 통해서 팀을 알 수 있습니다.</li>
<li>팀은 회원을 알 수 없습니다.</li>
</ul>
</li>
<li>테이블 연관 관계<ul>
<li>회원 테이블은 TEAM_ID 외래 키로 팀 테이블과 연관관계를 맺습니다.</li>
<li>회원 테이블과 팀 테이블은 양향관 관계입니다. 회원 테이블은 TEAM_ID 외래 키로 MEMBER JOIN TEAM 과 TEAM JOIN MEMBER 둘 다 가능합니다.</li>
</ul>
</li>
<li>개체 연관관계와 테이블 연관관계의 가장 큰 차이<ul>
<li>참조를 사용하는 객체의 연관관계는 언제나 단방향 입니다. 객체를 양방향으로 참조하려면 단방향 연관관계 2개를 만들어야합니다.</li>
<li>테이블은 외래 키 하나로 양방향으로 조인할 수 있습니다.</li>
</ul>
</li>
</ul>
<h5 id="1-1-객체-관계-매핑"><a href="#1-1-객체-관계-매핑" class="headerlink" title="1.1 객체 관계 매핑"></a>1.1 객체 관계 매핑</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 연관관계 매핑</span></span><br><span class="line">    <span class="meta">@ManyToOne</span> <span class="comment">// 회원관 팀은 다대일 관계</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name = <span class="string">"TEAM_ID"</span>) <span class="comment">//외래 키를 매핑할 때 사용. name 속성에는 매핑할 외래키 이름.</span></span><br><span class="line">    <span class="keyword">private</span> Team team;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 연관관계 설정</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.team = team;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter, Setter ..</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column</span> (name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter, Setter ..</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-연관관계-사용"><a href="#2-연관관계-사용" class="headerlink" title="2. 연관관계 사용"></a>2. 연관관계 사용</h4><p>연관 관계를 등록, 수정, 삭제, 조회하는 예제를 통해 연관관계를 어떻게 사용하는지 확인합니다.</p>
<h5 id="2-1-저장"><a href="#2-1-저장" class="headerlink" title="2.1 저장"></a>2.1 저장</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">// 팀 1 저장</span></span><br><span class="line">      Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">      team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">      team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 회원 1 저장</span></span><br><span class="line">      Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">      member1.setTeam(team1);</span><br><span class="line">      em.persist(member1); <span class="comment">// 연관관계 설정 member1 -&gt; team1</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 회원 2 저장</span></span><br><span class="line">      Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">      member2.setTeam(team1);</span><br><span class="line">      em.persist(member2); <span class="comment">// 연관관계 설정 member2 -&gt; team1</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-조회"><a href="#2-2-조회" class="headerlink" title="2.2 조회"></a>2.2 조회</h5><p>조회 방법은 두 가지 입니다.</p>
<ul>
<li>객체 그래프 탐색<ul>
<li>memebr.getTeam();</li>
</ul>
</li>
<li>JPQL<ul>
<li>select m from Member m join m.team t where t.name=:teamName</li>
<li>:로 시작하는 것은 파라미터를 바인딩하는 문법입니다.</li>
</ul>
</li>
</ul>
<h5 id="2-3-수정"><a href="#2-3-수정" class="headerlink" title="2.3 수정"></a>2.3 수정</h5><p>수정은 update() 가 없습니다. 불러온 엔티티의 값만 변경하면 트렌잭션을 커밋할 때, flush 가 일어나면서 변경 감지 기능이 작동합니다. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 새로운 팀2</span></span><br><span class="line">        Team team2 = <span class="keyword">new</span> Team();</span><br><span class="line">        em.persist(team2);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 회원1에 새로운 팀2 설정</span></span><br><span class="line">        Member member = em.find(Member.class, <span class="string">"member1"</span>);</span><br><span class="line">        member.setTeam(team2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-4-제거"><a href="#2-4-제거" class="headerlink" title="2.4 제거"></a>2.4 제거</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Member member = em.find(Member.class, <span class="string">"member1"</span>);</span><br><span class="line">        member.setTeam(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-5-삭제"><a href="#2-5-삭제" class="headerlink" title="2.5 삭제"></a>2.5 삭제</h5><p>기존에 있던 연관관계르ㅓㄹ 먼저 제거하여 삭제해야합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">member1.setTeam(<span class="keyword">null</span>); <span class="comment">// 회원1 연관관계 제거</span></span><br><span class="line">member2.setTeam(<span class="keyword">null</span>); <span class="comment">// 회원2 연관관계 제거</span></span><br><span class="line">em.remov(team); <span class="comment">// 팀삭제</span></span><br></pre></td></tr></table></figure>

<h4 id="3-양방향-연관관계"><a href="#3-양방향-연관관계" class="headerlink" title="3. 양방향 연관관계"></a>3. 양방향 연관관계</h4><p>회원에서 팀으로 접근하고, 반대 방향인 팀에서도 회원으로 접근하도록 합니다.</p>
<h5 id="3-1-양방향-연관관계-매핑"><a href="#3-1-양방향-연관관계-매핑" class="headerlink" title="3.1 양방향 연관관계 매핑"></a>3.1 양방향 연관관계 매핑</h5><p>회원 엔티티는 변경이 없습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 연관관계 매핑</span></span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">    <span class="keyword">private</span> Team team;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 연관관계 설정</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.team = team;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter, Setter ..</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>팀 엔티티에 Member list 를 추가했습니다. 그리고 일대다 관계를 매핑하기 위해 @OneToMany 를 설정했습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column</span> (name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany</span> (mappedBy = <span class="string">"team"</span>)</span><br><span class="line">    <span class="keyword">private</span> List&lt;Member&gt; memberList = <span class="keyword">new</span> ArrayList&lt;Member&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter, Setter ..</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-연관관계의-주인"><a href="#4-연관관계의-주인" class="headerlink" title="4. 연관관계의 주인"></a>4. 연관관계의 주인</h4><p>엔티티를 양방향 연관관계로 설정하면 객체의 참조는 둘인데, 외래 키는 하나입니다. 이런 차이로 인해 JPA 는 두 객체 연관관계 중 하나를 정해서 테이블의 외래키를 관리해야 하는데 이것을 연관관계의 주인이라고 합니다.</p>
<h5 id="4-1-양방향-매칭의-규칙-연관관계의-주인"><a href="#4-1-양방향-매칭의-규칙-연관관계의-주인" class="headerlink" title="4.1 양방향 매칭의 규칙 : 연관관계의 주인"></a>4.1 양방향 매칭의 규칙 : 연관관계의 주인</h5><p>연관계의 주인만이 데이터베이스 연관관계와 매핑되고, 외래 키를 관리 할 수 있습니다. 주인이 아닌 쪽은 읽기만 가능합니다. 연관관계의 주인을 정한다는 것은 외래 키 관리자를 선택한다는 것입니다.</p>
<h5 id="4-2-연관-관계의-주인은-외래-키가-있는-곳"><a href="#4-2-연관-관계의-주인은-외래-키가-있는-곳" class="headerlink" title="4.2 연관 관계의 주인은 외래 키가 있는 곳"></a>4.2 연관 관계의 주인은 외래 키가 있는 곳</h5><p>데이터베이스 테이블의 다대일, 일대다 관계에서는 항상 다 쪽이 외래키를 가집니다. 따라서, 다 쪽인 @ManyToOne 은 항상 연관계의 주인이므로 mappedBy 속성을 설정할 수 없습니다.</p>
<h4 id="5-양방향-연관관계의-주의점"><a href="#5-양방향-연관관계의-주의점" class="headerlink" title="5. 양방향 연관관계의 주의점"></a>5. 양방향 연관관계의 주의점</h4><p>연관관계의 주인에는 값을 입력하지 않고, 주인이 아닌 곳에만 값을 입력하는 경우를 봅시다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 회원 1 저장</span></span><br><span class="line">       Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">       em.persist(member1); <span class="comment">// 연관관계 설정 member1 -&gt; team1</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">// 회원 2 저장</span></span><br><span class="line">       Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">       em.persist(member2); <span class="comment">// 연관관계 설정 member2 -&gt; team1</span></span><br><span class="line">       </span><br><span class="line">       Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">       team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">       team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//주인이 아닌 곳에만 연관관계 설정</span></span><br><span class="line">       team1.getMemberList().add(member1)</span><br><span class="line">       team1.getMemberList().add(member2)</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>데이터베이스에서 회원테이블을 조회해 봅시다. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">MEMBER</span>;</span><br><span class="line"></span><br><span class="line">//결과</span><br><span class="line">Memer_ID / USERNAME / TEAM_ID</span><br><span class="line">member1 / 회원 1 / null</span><br><span class="line">member2 / 회원 2 / null</span><br></pre></td></tr></table></figure>

<h5 id="5-1-순수한-객체까지-고려한-양방향-연관관계"><a href="#5-1-순수한-객체까지-고려한-양방향-연관관계" class="headerlink" title="5.1 순수한 객체까지 고려한 양방향 연관관계"></a>5.1 순수한 객체까지 고려한 양방향 연관관계</h5><p>JPA를 사용하지 않고 순수한 객체로 테스트해 봅시다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">       team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">       team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line"></span><br><span class="line">       Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">       member1.setId(<span class="string">"member1"</span>);</span><br><span class="line">       member1.setUsername(<span class="string">"회원1"</span>);</span><br><span class="line"></span><br><span class="line">       Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">       member2.setId(<span class="string">"member2"</span>);</span><br><span class="line">       member2.setUsername(<span class="string">"회원2"</span>);</span><br><span class="line">       </span><br><span class="line">       member1.setTeam(team1); <span class="comment">// 연관 관계 설정 member1 -&gt; team1</span></span><br><span class="line">       member2.setTeam(team1); <span class="comment">// 연관 관계 설정 member2 -&gt; team1</span></span><br><span class="line"></span><br><span class="line">       List&lt;Member&gt; memberList = team1.getMemberList();</span><br><span class="line">       System.out.println(<span class="string">"member size : "</span> + memberList.size()); <span class="comment">// 출력 결과 : 0</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>회원 -&gt; 팀 을 설정하면 다음 코드 처럼 반대 방향인 팀 -&gt; 회원도 설정해야합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">        team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">        team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line"></span><br><span class="line">        Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">        member1.setId(<span class="string">"member1"</span>);</span><br><span class="line">        member1.setUsername(<span class="string">"회원1"</span>);</span><br><span class="line"></span><br><span class="line">        Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">        member2.setId(<span class="string">"member2"</span>);</span><br><span class="line">        member2.setUsername(<span class="string">"회원2"</span>);</span><br><span class="line">        </span><br><span class="line">        member1.setTeam(team1); <span class="comment">// 연관 관계 설정 member1 -&gt; team1</span></span><br><span class="line">  			team1.getMemberList.add(member1); <span class="comment">// 연관 관계 설정 team1 -&gt; member1</span></span><br><span class="line">  </span><br><span class="line">        member2.setTeam(team1); <span class="comment">// 연관 관계 설정 member2 -&gt; team1</span></span><br><span class="line">    		team1.getMemberList.add(member2); <span class="comment">// 연관 관계 설정 team1 -&gt; member2</span></span><br><span class="line"></span><br><span class="line">        List&lt;Member&gt; memberList = team1.getMemberList();</span><br><span class="line">        System.out.println(<span class="string">"member size : "</span> + memberList.size()); <span class="comment">// 출력 결과 : 2</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>JPA를 적용하면 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  			<span class="comment">// 팀1 저장</span></span><br><span class="line">        Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">        team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">        team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line">        em.persist(tema1);</span><br><span class="line"></span><br><span class="line">        Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">        member1.setId(<span class="string">"member1"</span>);</span><br><span class="line">        member1.setUsername(<span class="string">"회원1"</span>);</span><br><span class="line">  </span><br><span class="line">  			<span class="comment">// 양방향 연관관계 설정</span></span><br><span class="line"> 		    member1.setTeam(team1); <span class="comment">// 연관 관계 설정 member1 -&gt; team1</span></span><br><span class="line">  			team1.getMemberList.add(member1); <span class="comment">// 연관 관계 설정 team1 -&gt; member1</span></span><br><span class="line">  			em.persist(member1);</span><br><span class="line"></span><br><span class="line">        Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">        member2.setId(<span class="string">"member2"</span>);</span><br><span class="line">        member2.setUsername(<span class="string">"회원2"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 양방향 연관관계 설정</span></span><br><span class="line"> 		    member2.setTeam(team1); <span class="comment">// 연관 관계 설정 member2 -&gt; team1</span></span><br><span class="line">  			team1.getMemberList.add(member2); <span class="comment">// 연관 관계 설정 team1 -&gt; member2</span></span><br><span class="line">  			em.persist(member2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-2-연관관계-편의-메서드"><a href="#5-2-연관관계-편의-메서드" class="headerlink" title="5.2 연관관계 편의 메서드"></a>5.2 연관관계 편의 메서드</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">member1.setTeam(team1); <span class="comment">// 연관 관계 설정 member1 -&gt; team1</span></span><br><span class="line">team1.getMemberList.add(member1); <span class="comment">// 연관 관계 설정 team1 -&gt; member1</span></span><br></pre></td></tr></table></figure>

<p>양방향 관계에서는 위 두 코드를, 다음과 같이 하나인 것처럼 사용하는 것이 안전합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Team team;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.team = team;</span><br><span class="line">    team.getMemberList().add(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>따라서 다음과 같이 양방향 관계를 설정할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  			<span class="comment">// 팀1 저장</span></span><br><span class="line">        Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">        team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">        team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line">        em.persist(tema1);</span><br><span class="line"></span><br><span class="line">        Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">        member1.setId(<span class="string">"member1"</span>);</span><br><span class="line">        member1.setUsername(<span class="string">"회원1"</span>);</span><br><span class="line">  </span><br><span class="line">  			<span class="comment">// 양방향 연관관계 설정</span></span><br><span class="line"> 		    member1.setTeam(team1); </span><br><span class="line">  			em.persist(member1);</span><br><span class="line"></span><br><span class="line">        Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">        member2.setId(<span class="string">"member2"</span>);</span><br><span class="line">        member2.setUsername(<span class="string">"회원2"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 양방향 연관관계 설정</span></span><br><span class="line"> 		    member2.setTeam(team1); <span class="comment">// 연관 관계 설정 member2 -&gt; team1</span></span><br><span class="line">  			em.persist(member2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-3-연관관계-편의-메서드-작성시-주의-사항"><a href="#5-3-연관관계-편의-메서드-작성시-주의-사항" class="headerlink" title="5.3 연관관계 편의 메서드 작성시 주의 사항"></a>5.3 연관관계 편의 메서드 작성시 주의 사항</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">member.setTeam(teamA);</span><br><span class="line">member.setTeam(teamB);</span><br><span class="line">Member findMember = teaA.getMember(); <span class="comment">//member1이 여전히 조회</span></span><br></pre></td></tr></table></figure>

<p>이는, teamB로 변경할 때, teamA -&gt; member 관계를 제거 하지 않았기 때문입니다. 따라서 편의 메서드를 다음과 같이 수정해야 합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 기존 팀과 관계를 제거</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.team != <span class="keyword">null</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>.team.getMemberList.remove(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>.team = team1; <span class="comment">// 연관 관계 설정 member -&gt; team</span></span><br><span class="line">  team.getMemberList.add(<span class="keyword">this</span>); <span class="comment">// 연관 관계 설정 team -&gt; member</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p>자바 ORM 표준 프로그래밍 &lt;김영한&gt;</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2019/03/26/basic-relation-mapping/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2019/03/20/entity mapping/">
                            [자바 ORM 표준 JPA 프로그래밍] 4장_앤티티 매핑
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-03-20T00:00:00+09:00">
	
		    Mar 20, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/jpa/">JPA</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>엔티티와 테이블을 정확히 매핑하기 위해 JPA는 다양한 어노테이션을 지원합니다. 이번 포스팅에서는 다음 매핑에 대해 다룹니다.</p>
<ul>
<li>객체와 테이블 매핑<ul>
<li>@Entity, @Table</li>
</ul>
</li>
<li>기본 키 매핑<ul>
<li>@Id</li>
</ul>
</li>
<li>필드와 컬럼 매핑<ul>
<li>@Column</li>
</ul>
</li>
</ul>
<h4 id="Entity"><a href="#Entity" class="headerlink" title="@Entity"></a>@Entity</h4><p>JPA를 사용해서 테이블을 매핑할 클래스는 @Entity 를 필수로 붙여야합니다. @Entity 적용시 기본 생성자는 필수입니다.</p>
<h4 id="Table"><a href="#Table" class="headerlink" title="@Table"></a>@Table</h4><p>엔티티와 매핑할 테이블을 지정합니다. </p>
<h4 id="데이터베이스-스키마-자동-생성"><a href="#데이터베이스-스키마-자동-생성" class="headerlink" title="데이터베이스 스키마 자동 생성"></a>데이터베이스 스키마 자동 생성</h4><p>JPA는 클래스의 매핑 정보와 데이터베이스 방언을 사용해서 데이터베이스 스키마를 생성합니다. 다음과 같이 설정하면 기존 테이블을 삭제하고 새로 생성합니다 (DROP+CREATE).  create-drop / update / validate / none 옵션이 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">spring.jpa.hibernate.ddl-auto=create</span><br></pre></td></tr></table></figure>

<h4 id="기본-키-Primary-Key-매핑"><a href="#기본-키-Primary-Key-매핑" class="headerlink" title="기본 키 (Primary Key) 매핑"></a>기본 키 (Primary Key) 매핑</h4><p>JPA가 제공하는 데이터베이스 기본 키 생성 전략은 다음과 같습니다.</p>
<ul>
<li>직접 할당<ul>
<li>애플리케이션에서 직접 할당합니다.</li>
</ul>
</li>
<li>자동 생성<ul>
<li>IDENTITY<ul>
<li>기본 키 생성을 데이터베이스에 위임합니다.</li>
</ul>
</li>
<li>SEQUENCE<ul>
<li>데이터베이스 시퀀스를 사용해 기본 키를 할당합니다.</li>
</ul>
</li>
<li>TABLE<ul>
<li>키 생성 테이블을 사용합니다.</li>
</ul>
</li>
</ul>
</li>
</ul>
<h4 id="Column"><a href="#Column" class="headerlink" title="@Column"></a>@Column</h4><p>객체 필드를 테이블 칼럼에 매핑합니다. 속성 중에 name, nullable 이 주로 사용됩니다.</p>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p>자바 ORM 표준 프로그래밍 &lt;김영한&gt;</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2019/03/20/entity mapping/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2019/03/20/persistence context/">
                            [자바 ORM 표준 JPA 프로그래밍] 3장_영속성 관리
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-03-20T00:00:00+09:00">
	
		    Mar 20, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/jpa/">JPA</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>이번 포스팅에서는 Mapping 한 Entity 를 Entity Manager 를 통해 어떻게 사용하는지 정리합니다.</p>
<h4 id="Entity-Manager-Factory-Entity-Manager"><a href="#Entity-Manager-Factory-Entity-Manager" class="headerlink" title="Entity Manager Factory, Entity Manager"></a>Entity Manager Factory, Entity Manager</h4><p>엔티티 메니저 펙토리는 한 개만 만들어서 애플리케이션 전체에서 공유합니다. 엔티티 메니저 펙토리는 서도 다른 스레드 간에 공유해도 되지만, 엔티티 메니저는 여러 스레드가 동시에 접근하면 동시성 문제가 발생하므로 스레드 간에 절대 공유하면 안됩니다.</p>
<h4 id="Persistence-Context"><a href="#Persistence-Context" class="headerlink" title="Persistence Context"></a>Persistence Context</h4><p>엔티티를 여구 저장하는 환경입니다. 엔티티 메니저로 엔티티를 저장하거나 조회하면 엔티티 메니저는 영속성 컨텍스트에 엔티티를 보관하고 관리합니다.</p>
<h4 id="엔티티의-생명주기"><a href="#엔티티의-생명주기" class="headerlink" title="엔티티의 생명주기"></a>엔티티의 생명주기</h4><p>4가지 상태가 있습니다.</p>
<ul>
<li>비영속<ul>
<li>영속성 컨텍스트와 관계 없는 상태 </li>
</ul>
</li>
<li>영속<ul>
<li>영속성 컨텍스트에 저장된 상태</li>
</ul>
</li>
<li>준영속<ul>
<li>영속성 컨텍스트에 저장되었다가 분리된 상태</li>
</ul>
</li>
<li>삭제<ul>
<li>삭제된 상태</li>
</ul>
</li>
</ul>
<h4 id="영속성-컨텍스트의-특징"><a href="#영속성-컨텍스트의-특징" class="headerlink" title="영속성 컨텍스트의 특징"></a>영속성 컨텍스트의 특징</h4><ul>
<li>영속 상태는 식별자 값이 반드시 있어야합니다.</li>
<li>보통 Transaction 을 Commit 하는 순간 영속성 컨텍스트에 저장된 엔티티를 데이터베이스에 반영합니다. (Flush)</li>
<li>1차 캐쉬 / 동일성 보장 / 쓰기 지연 / 변경 감지 / 지연 로딩</li>
</ul>
<h4 id="엔티티-조회"><a href="#엔티티-조회" class="headerlink" title="엔티티 조회"></a>엔티티 조회</h4><p>영속성 컨텍스트는 내부에 1차 캐시를 가지고 있습니다. 쉽게 이야기해, Map 처럼 키는 @Id로 매핑한 식별자이고 값은 엔티티 인스턴스입니다. 1차 캐시에 저장된 엔티티를 조회할 때 , 1차 캐시에 엔티티가 있으면 데이터베이스를 조회하지 않고 메모리에 있는 1차 캐시에서 엔티티를 조회합니다. 만약, 1차 캐시에 없으면 엔티티 메니저는 데이터베이스를 조회해서 엔티티를 생성하고 1차 캐시에 저장한 후에 영속 상태의 엔티티를 반환합니다. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">entityManger.find(Member.class, <span class="string">"member1"</span>);</span><br></pre></td></tr></table></figure>

<h4 id="영속-엔티티의-동일성-보장"><a href="#영속-엔티티의-동일성-보장" class="headerlink" title="영속 엔티티의 동일성 보장"></a>영속 엔티티의 동일성 보장</h4><p>영속성 컨텍스트는 성능상 이점과 엔티티의 동일성을 보장합니다. 따라서, 다음 코드의 결과는 참입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Member a = em.find(Member.class, <span class="string">"member1"</span>);</span><br><span class="line">Member b = em.find(Member.class, <span class="string">"member1"</span>);</span><br><span class="line"></span><br><span class="line">System.out.println(a==b);</span><br></pre></td></tr></table></figure>

<h4 id="엔티티-등록"><a href="#엔티티-등록" class="headerlink" title="엔티티 등록"></a>엔티티 등록</h4><p>엔티티 메니저는 트랜잭션을 커밋하기 직전까지 데이터베이스에 엔티티를 저장하지 않고 내부 쿼리 저장소에 INSERT SQL을 모아둡니다. 그리고 커밋할 때 모아둔 쿼리를 데이터베이스에 보냅니다. 이것을 Transactional Write Behind (쓰기 지연) 라고 합니다.</p>
<h4 id="엔티티-수정"><a href="#엔티티-수정" class="headerlink" title="엔티티 수정"></a>엔티티 수정</h4><p>엔티티의 변경사항을 데이터베이스에 자동으로 반영하는 기능을 Dirty Checking (변경 감지) 이라고 합니다. 순서는 다음과 같습니다.</p>
<ol>
<li>커밋하면 엔티티 메니저 내부에서 flush() 가 호출됩니다.</li>
<li>엔티티와 스냅샷 (JPA는 엔티티를 영속성 컨텐스트에 보관할 때, 최초 상태를 복사해서 저장합니다 )을 비교해서 변경된 엔티티를 찾습니다.</li>
<li>변경된 엔티티가 있으면 수정 쿼리를 생성해서 쓰기 지연 SQL 저장소에 보냅니다.</li>
<li>데이터베이스 트랜잭션을 커밋합니다.</li>
</ol>
<p>그리고 UPDATE SQL 을 생성할 때, 변경된 부분만 사용해서 동적으로 생성되는 것이 아니라, 엔티티의 모든 필드를 업데이트 합니다.</p>
<h4 id="엔티티-삭제"><a href="#엔티티-삭제" class="headerlink" title="엔티티 삭제"></a>엔티티 삭제</h4><p>엔티티 등록과 비슷하게 삭제 쿼리를 쓰기 지연 SQL 저장소에 등록하고 트랜잭션을 커밋해서 flush()를 호출하면 데이터베이스에 삭제 쿼리를 전달합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Member a = em.find(Member.class, <span class="string">"member1"</span>);</span><br><span class="line">em.remove(a);</span><br></pre></td></tr></table></figure>

<h4 id="플러쉬"><a href="#플러쉬" class="headerlink" title="플러쉬"></a>플러쉬</h4><p>영속성 컨테르를 플러쉬하는 방법은 3가지입니다.</p>
<ul>
<li>em.flush() 직접 호출</li>
<li>트랜잭션 커밋 시 플러쉬 자동 호출</li>
<li>JPQL 쿼리 실행시 플러쉬 자동 호출</li>
</ul>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p>자바 ORM 표준 프로그래밍 &lt;김영한&gt;</p>

                    
                        

                    
                    
                        <p>
                            <a href="/2019/03/20/persistence context/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2019/03/18/JPA Simple Test/">
                            JPA Simple Test
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-03-18T00:00:00+09:00">
	
		    Mar 18, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/jpa/">JPA</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>이번 포스팅에서는 JPA를 이용해 객체를 Database 에 저장하는 Test를 하고자 합니다. Database는 Docker 를 통해 Postgres를 사용합니다.</p>
<h4 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h4><p>Docker는 공식 홈페이지에서 쉽게 설치할 수 있습니다 : <a href="https://docs.docker.com/docker-for-mac/install/" target="_blank" rel="noopener">https://docs.docker.com/docker-for-mac/install/</a> </p>
<p>Docker 를 설치하고 다음 명령어를 통해 Postgres Container를 띄웁니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -p <span class="number">5432</span>:<span class="number">5432</span> -e POSTGRES_PASSWORD=<span class="number">1234</span> -e POSTGRES_USER=jko -e POSTGRES_DB=springdata --name postgres_boot -d postgres</span><br></pre></td></tr></table></figure>

<p>Postgres Bash에 붙습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker exec -i -t postgres_boot bash</span><br></pre></td></tr></table></figure>

<p>postgres 계정으로 springdata 데이터베이스에 접근합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">su - postgres</span><br><span class="line">psql springdata</span><br></pre></td></tr></table></figure>

<p>Account 테이블을 생성합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">CREATE TABLE <span class="title">ACCOUNT</span> <span class="params">(id <span class="keyword">int</span>, username varchar(<span class="number">255</span>)</span>, password <span class="title">varchar</span><span class="params">(<span class="number">255</span>)</span>)</span>;</span><br></pre></td></tr></table></figure>

<h4 id="의존성-추가"><a href="#의존성-추가" class="headerlink" title="의존성 추가"></a>의존성 추가</h4><p>JPA를 사용하기 위한 의존성과 Postgresql 을 사용하기 위한 의존성을 추가합니다.</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-data-jpa&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">	&lt;groupId&gt;org.postgresql&lt;/groupId&gt;</span><br><span class="line">	&lt;artifactId&gt;postgresql&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h4 id="설정"><a href="#설정" class="headerlink" title="설정"></a>설정</h4><p>Database 연결을 위한 정보를 입력하고, Database Schema를 실행시마다 새로 생성되게 (ddl-auto=create) 설정합니다. 그리고, non_contextual_create=true 를 설정해야 어플리케이션 실행시 발생하는 postgres 에러를 해결할 수 있습니다. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">spring.datasource.url=jdbc:postgresql:<span class="comment">//localhost:5432/springdata</span></span><br><span class="line">spring.datasource.username=jko</span><br><span class="line">spring.datasource.password=<span class="number">1234</span></span><br><span class="line"></span><br><span class="line">spring.jpa.hibernate.ddl-auto=create</span><br><span class="line">spring.jpa.properties.hibernate.jdbc.lob.non_contextual_creation=<span class="keyword">true</span></span><br></pre></td></tr></table></figure>

<h4 id="Account"><a href="#Account" class="headerlink" title="Account"></a>Account</h4><p>Account Class를 다음과 같이 정의합니다. @Entity 에 이름을 따로 정하지 않으면 Class의 이름이 Table의 이름으로 매칭됩니다. 그리고, 각 필드 (id, username, password) 에는 @Column 이 생략되어 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jko.jpatest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.Entity;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.GeneratedValue;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.Id;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Long <span class="title">getId</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setId</span><span class="params">(Long id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUsername</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUsername</span><span class="params">(String username)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.username = username;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getPassword</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> password;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setPassword</span><span class="params">(String password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.password = password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="JpaRunner"><a href="#JpaRunner" class="headerlink" title="JpaRunner"></a>JpaRunner</h4><p>Database 에 Insert Query 를 날리기 위해 JPA api 를 사용할 수도 있고, Hibernate api 를 사용할 수 도 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> jko.jpatest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.hibernate.Session;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationArguments;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.ApplicationRunner;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.EntityManager;</span><br><span class="line"><span class="keyword">import</span> javax.persistence.PersistenceContext;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">JpaRunner</span> <span class="keyword">implements</span> <span class="title">ApplicationRunner</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PersistenceContext</span></span><br><span class="line">    EntityManager entityManager;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">(ApplicationArguments args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">        Account account = <span class="keyword">new</span> Account();</span><br><span class="line">        account.setUsername(<span class="string">"jko"</span>);</span><br><span class="line">        account.setPassword(<span class="string">"123"</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        1. jpa api</span></span><br><span class="line"><span class="comment">//        entityManager.persist(account);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//		2. hibernate api</span></span><br><span class="line">        Session session = entityManager.unwrap(Session.class);</span><br><span class="line">        session.save(account);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p><a href="https://www.inflearn.com/course/스프링-데이터-jpa" target="_blank" rel="noopener">https://www.inflearn.com/course/스프링-데이터-jpa</a></p>

                    
                        

                    
                    
                        <p>
                            <a href="/2019/03/18/JPA Simple Test/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2019/03/13/ORM/">
                            ORM
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-03-13T00:00:00+09:00">
	
		    Mar 13, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/jpa/">JPA</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <h4 id="JPA-Java-Persistence-API"><a href="#JPA-Java-Persistence-API" class="headerlink" title="JPA (Java Persistence API)"></a>JPA (Java Persistence API)</h4><p>자바 진영의 ORM 기술 표준입니다. Application 과 JDBC 사이에서 동작합니다.<br>JPA는 쉽게 이야기해서, 인터페이스를 모아둔 것입니다. 따라서 JPA를 사용하기 위해서는, JPA를 구현한 ORM Framework를 선택해야합니다.</p>
<h4 id="ORM-Framework"><a href="#ORM-Framework" class="headerlink" title="ORM Framework"></a>ORM Framework</h4><ul>
<li>Hibernate</li>
<li>EclipseLink</li>
<li>DataNucleus</li>
</ul>
<h4 id="ORM-Object-Relational-Mapping"><a href="#ORM-Object-Relational-Mapping" class="headerlink" title="ORM (Object-Relational Mapping)"></a>ORM (Object-Relational Mapping)</h4><p>ORM은 애플리케이션의 클래스와 SQL 데이터베이스의 테이블 사이의 맵핑 정보를 기술한 메타데이터를 사용하여 자바 애플리케이션의 객체를 SQL데이터베이스의 테이블에 자동으로 영속화 해주는 기술입니다.</p>
<h4 id="궁극적으로-코딩하려는-방법"><a href="#궁극적으로-코딩하려는-방법" class="headerlink" title="궁극적으로 코딩하려는 방법"></a>궁극적으로 코딩하려는 방법</h4><p>Hibernate나 JPA 같은 ORM을 사용해서 궁극적으로 코딩을 하려는 방법은 Domain Model을 사용하는 방식 (Object) 으로 프로그래밍을 하려고 합니다.<br>Hibernate가 자동생성하는 SQL뿐만 아니라 임의로 JDBC를 사용하는 Query를 직접 사용할 수도 있습니다.</p>
<h4 id="JDBC-를-직접-사용-하는-방식"><a href="#JDBC-를-직접-사용-하는-방식" class="headerlink" title="JDBC 를 직접 사용 하는 방식"></a>JDBC 를 직접 사용 하는 방식</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>(Connection connection = DriverManager.getConnection(url, username, password))&#123;</span><br><span class="line">    System.out.println(<span class="string">"Connection created: "</span>+ connection);</span><br><span class="line">    String sql = <span class="string">"CREATE TABLE ACCOUNT (id int, username varchar(255), password varchar(255));"</span>;</span><br><span class="line">    sql = <span class="string">"INSERT INTO ACCOUNT VALUES(1, 'freelife', 'pass');"</span>;</span><br><span class="line">    <span class="keyword">try</span>(PreparedStatement statement = connection.prepareStatement(sql))&#123;</span><br><span class="line">        statement.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Domain-Model-을-사용하는-방식"><a href="#Domain-Model-을-사용하는-방식" class="headerlink" title="Domain Model 을 사용하는 방식"></a>Domain Model 을 사용하는 방식</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Account account = <span class="keyword">new</span> Account(“freelife”, “pass”);</span><br><span class="line">accountRepository.save(account);</span><br></pre></td></tr></table></figure>

<h4 id="왜-Domain-Model-을-사용할까"><a href="#왜-Domain-Model-을-사용할까" class="headerlink" title="왜 Domain Model 을 사용할까"></a>왜 Domain Model 을 사용할까</h4><ul>
<li>객체 지향 프로그래밍의 장점을 활용</li>
<li>각종 디자인 패턴을 적용</li>
<li>코드 재사용성이 증가</li>
<li>비즈니스 로직 구현 및 테스트 용이</li>
</ul>
<h4 id="ORM의-장점"><a href="#ORM의-장점" class="headerlink" title="ORM의 장점"></a>ORM의 장점</h4><ul>
<li>생산성<ul>
<li>SQL을 작성하고 JDBC API를 사용하는 반복적인 작업을 개발자가 직접 하지 않아도 됩니다.</li>
</ul>
</li>
<li>유지보수성<ul>
<li>코드가 굉장히 간결해지고 코드양이 줄어 유지보수성 증가합니다.</li>
</ul>
</li>
<li>성능<ul>
<li>논쟁의 여지가 있음 SQL단건만 보면 ORM이 더 느릴수있습니다.</li>
<li>Hibernate는 객체와 테이블에 데이터 사이에 캐시가 존재하므로 불필요한 쿼리를 사용하지 않습니다.</li>
<li>하나의 트랜잭션 내에서 여러 요청이 일어나도 정말로 데이터베이스에 반영해야되는 시점에만 반영을 합니다.</li>
<li>데이터가 같거나 반영할 필요가 없다면 반영하지 않아서 성능에 장점이 있습니다.</li>
<li>성능 최적화를 위한 여러가지 기능들을 제공함</li>
</ul>
</li>
<li>벤더 독립성<ul>
<li>데이터베이스를 변경하면 JPA 에게 다른 데이터베이스를 사용한다고 알려주기만 하면 됩니다.</li>
<li>데이터베이스가 바뀌어도 코드가 변경되지 않습니다.</li>
<li>Hibernate가 데이터베이스 sync를 할때 객체를 영속화 할때 발생하는 SQL만 자동으로 바뀝니다.</li>
</ul>
</li>
</ul>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ul>
<li><a href="https://www.inflearn.com/course/스프링-데이터-jpa" target="_blank" rel="noopener">https://www.inflearn.com/course/스프링-데이터-jpa</a></li>
<li>자바 ORM 표준 프로그래밍 &lt;김영한&gt;</li>
</ul>

                    
                        

                    
                    
                        <p>
                            <a href="/2019/03/13/ORM/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    
    <article class="postShorten postShorten--thumbnailimg-bottom">
        <div class="postShorten-wrap">
            
            <div class="postShorten-header">
                <h1 class="postShorten-title">
                    
                        <a class="link-unstyled" href="/2019/03/13/JPA Paradigm/">
                            패러다임의 불일치
                        </a>
                    
                </h1>
                <div class="postShorten-meta">
    <time datetime="2019-03-13T00:00:00+09:00">
	
		    Mar 13, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/jpa/">JPA</a>


    
</div>

            </div>
            
                <div class="postShorten-content">
                    <p>객체 모델과 관계형 데이터베이스 모델은 지향하는 페러다임이 서로 다릅니다. 페러다임의 불일치 문제를 해결하기 위한 결과물이 ‘JPA’ 입니다. 이번 포스트에서는 객체 모델과 관계형 데이터베이스 모델의 페러다임 차이를 비교합니다.</p>
<h4 id="Granularity-밀도"><a href="#Granularity-밀도" class="headerlink" title="Granularity (밀도)"></a>Granularity (밀도)</h4><ul>
<li>객체<ul>
<li>다양한 크기의 객체</li>
<li>커스텀한 타입</li>
</ul>
</li>
<li>릴레이션<ul>
<li>테이블</li>
<li>기본 데이터 타입 (UDT는 비추)</li>
</ul>
</li>
</ul>
<h4 id="Subtype"><a href="#Subtype" class="headerlink" title="Subtype"></a>Subtype</h4><ul>
<li>객체<ul>
<li>상속 구조</li>
<li>다형성</li>
</ul>
</li>
<li>릴레이션<ul>
<li>테이블 상속 無 (상속 기능을 구현했다 하더라도 표준 기술이 아닙니다.)</li>
<li>다형적인 관계 無</li>
</ul>
</li>
</ul>
<h4 id="Identity"><a href="#Identity" class="headerlink" title="Identity"></a>Identity</h4><ul>
<li>객체<ul>
<li>레퍼런스 동일성 (==)</li>
<li>인스턴스 동일성 (equals() 메소드)</li>
</ul>
</li>
<li>릴레이션<ul>
<li>주키 (primary key)</li>
</ul>
</li>
</ul>
<h4 id="Association"><a href="#Association" class="headerlink" title="Association"></a>Association</h4><ul>
<li>객체<ul>
<li>객체 레퍼런스로 관계 표현</li>
<li>방향이 존재</li>
<li>다대다 관계 가능</li>
</ul>
</li>
<li>릴레이션<ul>
<li>Foreign Key 로 관계 표현</li>
<li>방향이라는 의미가 無</li>
<li>다대다 관계 불가능. (조인 테이블 또는 링크 테이블을 사용해서 두개의 1대다 관계로 풀어야 합니다)</li>
</ul>
</li>
</ul>
<h4 id="Data-Navigation"><a href="#Data-Navigation" class="headerlink" title="Data Navigation"></a>Data Navigation</h4><ul>
<li>객체<ul>
<li>레퍼런스를 이용해 다른 객체로 이동 가능</li>
<li>콜렉션 순회 가능</li>
</ul>
</li>
<li>릴레이션<ul>
<li>SQL을 직접 다루면 처음 실행하는 SQL에 따라 객체 그래프를 어디까지 탐색할 수 있는지 정해집니다. 이것은 큰 제약입니다. 왜냐하면, 비즈니스 로직에 따라 사용하는 객체 그래프가 다른므로 언제 끊어질지 모를 개체 그래프를 함부로 탐색할 수 없기 때문입니다.</li>
<li>데이터베이스에 요청을 적게 할 수록 성능이 좋습니다. 따라서 Join을 씁니다.</li>
<li>너무 많이 한 번에 가져오려고 해도 문제입니다.</li>
</ul>
</li>
</ul>
<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><ul>
<li><a href="https://www.inflearn.com/course/스프링-데이터-jpa" target="_blank" rel="noopener">https://www.inflearn.com/course/스프링-데이터-jpa</a></li>
<li>자바 ORM 표준 프로그래밍 &lt;김영한&gt;</li>
</ul>

                    
                        

                    
                    
                        <p>
                            <a href="/2019/03/13/JPA Paradigm/#post-footer" class="postShorten-excerpt_link link">
                                Comment and share
                            </a>
                        </p>
                    
                </div>
            
        </div>
        
    </article>
    
    <div class="pagination-bar">
    <ul class="pagination">
        
        
        <li class="pagination-number">page 1 of 1</li>
    </ul>
</div>

</section>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2019 junhee.ko. All Rights Reserved.
    </span>
</footer>

            </div>
            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">junhee.ko</h4>
        
            <div id="about-card-bio"><p>Always Learning</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Engineer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Incheon
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->



    </body>
</html>
