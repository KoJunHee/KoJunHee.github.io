
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="junhee.ko">
    <title>[자바 ORM 표준 JPA 프로그래밍] 5장_연관관계 매핑 기초 - junhee.ko</title>
    <meta name="author" content="junhee.ko">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"junhee.ko","sameAs":["https://github.com/kojunhee","https://facebook.com/kojunheee","https://www.linkedin.com/in/junheeko","mailto:junheee.ko@gmail.com"],"image":"profile.jpg"},"articleBody":"이번 포스팅에서는 객체의 참조와 테이블의 외래키를 매핑하는 것을 다룹니다. \n1. 단방향 연관관계회원과 팀의 다대일 단방향 관계 (맴버-&gt;팀) 를 생각해봅시다.\n\n객체 연관 관계\n회원은 Member.team 필드를 통해서 팀을 알 수 있습니다.\n팀은 회원을 알 수 없습니다.\n\n\n테이블 연관 관계\n회원 테이블은 TEAM_ID 외래 키로 팀 테이블과 연관관계를 맺습니다.\n회원 테이블과 팀 테이블은 양향관 관계입니다. 회원 테이블은 TEAM_ID 외래 키로 MEMBER JOIN TEAM 과 TEAM JOIN MEMBER 둘 다 가능합니다.\n\n\n개체 연관관계와 테이블 연관관계의 가장 큰 차이\n참조를 사용하는 객체의 연관관계는 언제나 단방향 입니다. 객체를 양방향으로 참조하려면 단방향 연관관계 2개를 만들어야합니다.\n테이블은 외래 키 하나로 양방향으로 조인할 수 있습니다.\n\n\n\n1.1 객체 관계 매핑12345678910111213141516171819202122@Entitypublic class Member &#123;    @Id    @Column(name = \"MEMBER_ID\")    private String id;    private String username;    // 연관관계 매핑    @ManyToOne // 회원관 팀은 다대일 관계    @JoinColumn(name = \"TEAM_ID\") //외래 키를 매핑할 때 사용. name 속성에는 매핑할 외래키 이름.    private Team team;        // 연관관계 설정    public void setTeam(Team team)&#123;        this.team = team;    &#125;    // Getter, Setter ..&#125;\n\n1234567891011public class Team &#123;    @Id    @Column (name = \"TEAM_ID\")    private String id;    private String name;    // Getter, Setter ..&#125;\n\n2. 연관관계 사용연관 관계를 등록, 수정, 삭제, 조회하는 예제를 통해 연관관계를 어떻게 사용하는지 확인합니다.\n2.1 저장12345678910111213141516public void save()&#123;      // 팀 1 저장      Team team1 = new Team();      team1.setId(\"team1\");      team1.setName(\"팀1\");      // 회원 1 저장      Member member1 = new Member();      member1.setTeam(team1);      em.persist(member1); // 연관관계 설정 member1 -&gt; team1      // 회원 2 저장      Member member2 = new Member();      member2.setTeam(team1);      em.persist(member2); // 연관관계 설정 member2 -&gt; team1  &#125;\n\n2.2 조회조회 방법은 두 가지 입니다.\n\n객체 그래프 탐색\nmemebr.getTeam();\n\n\nJPQL\nselect m from Member m join m.team t where t.name=:teamName\n:로 시작하는 것은 파라미터를 바인딩하는 문법입니다.\n\n\n\n2.3 수정수정은 update() 가 없습니다. 불러온 엔티티의 값만 변경하면 트렌잭션을 커밋할 때, flush 가 일어나면서 변경 감지 기능이 작동합니다. \n123456789public static void update()&#123;        // 새로운 팀2        Team team2 = new Team();        em.persist(team2);                // 회원1에 새로운 팀2 설정        Member member = em.find(Member.class, \"member1\");        member.setTeam(team2);    &#125;\n\n2.4 제거1234public static void delete()&#123;        Member member = em.find(Member.class, \"member1\");        member.setTeam(null);    &#125;\n\n2.5 삭제기존에 있던 연관관계르ㅓㄹ 먼저 제거하여 삭제해야합니다.\n123member1.setTeam(null); // 회원1 연관관계 제거member2.setTeam(null); // 회원2 연관관계 제거em.remov(team); // 팀삭제\n\n3. 양방향 연관관계회원에서 팀으로 접근하고, 반대 방향인 팀에서도 회원으로 접근하도록 합니다.\n3.1 양방향 연관관계 매핑회원 엔티티는 변경이 없습니다.\n12345678910111213141516171819202122@Entitypublic class Member &#123;    @Id    @Column(name = \"MEMBER_ID\")    private String id;    private String username;    // 연관관계 매핑    @ManyToOne    @JoinColumn(name = \"TEAM_ID\")    private Team team;    // 연관관계 설정    public void setTeam(Team team)&#123;        this.team = team;    &#125;    // Getter, Setter ..&#125;\n\n팀 엔티티에 Member list 를 추가했습니다. 그리고 일대다 관계를 매핑하기 위해 @OneToMany 를 설정했습니다.\n123456789101112131415@Entitypublic class Team &#123;    @Id    @Column (name = \"TEAM_ID\")    private String id;    private String name;    @OneToMany (mappedBy = \"team\")    private List&lt;Member&gt; memberList = new ArrayList&lt;Member&gt;();    // Getter, Setter ..    &#125;\n\n4. 연관관계의 주인엔티티를 양방향 연관관계로 설정하면 객체의 참조는 둘인데, 외래 키는 하나입니다. 이런 차이로 인해 JPA 는 두 객체 연관관계 중 하나를 정해서 테이블의 외래키를 관리해야 하는데 이것을 연관관계의 주인이라고 합니다.\n4.1 양방향 매칭의 규칙 : 연관관계의 주인연관계의 주인만이 데이터베이스 연관관계와 매핑되고, 외래 키를 관리 할 수 있습니다. 주인이 아닌 쪽은 읽기만 가능합니다. 연관관계의 주인을 정한다는 것은 외래 키 관리자를 선택한다는 것입니다.\n4.2 연관 관계의 주인은 외래 키가 있는 곳데이터베이스 테이블의 다대일, 일대다 관계에서는 항상 다 쪽이 외래키를 가집니다. 따라서, 다 쪽인 @ManyToOne 은 항상 연관계의 주인이므로 mappedBy 속성을 설정할 수 없습니다.\n5. 양방향 연관관계의 주의점연관관계의 주인에는 값을 입력하지 않고, 주인이 아닌 곳에만 값을 입력하는 경우를 봅시다.\n12345678910111213141516171819public void save()&#123;       // 회원 1 저장       Member member1 = new Member();       em.persist(member1); // 연관관계 설정 member1 -&gt; team1       // 회원 2 저장       Member member2 = new Member();       em.persist(member2); // 연관관계 설정 member2 -&gt; team1              Team team1 = new Team();       team1.setId(\"team1\");       team1.setName(\"팀1\");              //주인이 아닌 곳에만 연관관계 설정       team1.getMemberList().add(member1)       team1.getMemberList().add(member2)   &#125;\n\n데이터베이스에서 회원테이블을 조회해 봅시다. \n123456SELECT * FROM MEMBER;//결과Memer_ID / USERNAME / TEAM_IDmember1 / 회원 1 / nullmember2 / 회원 2 / null\n\n5.1 순수한 객체까지 고려한 양방향 연관관계JPA를 사용하지 않고 순수한 객체로 테스트해 봅시다.\n1234567891011121314151617181920public void test()&#123;       Team team1 = new Team();       team1.setId(\"team1\");       team1.setName(\"팀1\");       Member member1 = new Member();       member1.setId(\"member1\");       member1.setUsername(\"회원1\");       Member member2 = new Member();       member2.setId(\"member2\");       member2.setUsername(\"회원2\");              member1.setTeam(team1); // 연관 관계 설정 member1 -&gt; team1       member2.setTeam(team1); // 연관 관계 설정 member2 -&gt; team1       List&lt;Member&gt; memberList = team1.getMemberList();       System.out.println(\"member size : \" + memberList.size()); // 출력 결과 : 0   &#125;\n\n회원 -&gt; 팀 을 설정하면 다음 코드 처럼 반대 방향인 팀 -&gt; 회원도 설정해야합니다.\n1234567891011121314151617181920212223public void test()&#123;        Team team1 = new Team();        team1.setId(\"team1\");        team1.setName(\"팀1\");        Member member1 = new Member();        member1.setId(\"member1\");        member1.setUsername(\"회원1\");        Member member2 = new Member();        member2.setId(\"member2\");        member2.setUsername(\"회원2\");                member1.setTeam(team1); // 연관 관계 설정 member1 -&gt; team1  \t\t\tteam1.getMemberList.add(member1); // 연관 관계 설정 team1 -&gt; member1          member2.setTeam(team1); // 연관 관계 설정 member2 -&gt; team1    \t\tteam1.getMemberList.add(member2); // 연관 관계 설정 team1 -&gt; member2        List&lt;Member&gt; memberList = team1.getMemberList();        System.out.println(\"member size : \" + memberList.size()); // 출력 결과 : 2    &#125;\n\nJPA를 적용하면 다음과 같습니다.\n1234567891011121314151617181920212223242526public void test()&#123;  \t\t\t// 팀1 저장        Team team1 = new Team();        team1.setId(\"team1\");        team1.setName(\"팀1\");        em.persist(tema1);        Member member1 = new Member();        member1.setId(\"member1\");        member1.setUsername(\"회원1\");    \t\t\t// 양방향 연관관계 설정 \t\t    member1.setTeam(team1); // 연관 관계 설정 member1 -&gt; team1  \t\t\tteam1.getMemberList.add(member1); // 연관 관계 설정 team1 -&gt; member1  \t\t\tem.persist(member1);        Member member2 = new Member();        member2.setId(\"member2\");        member2.setUsername(\"회원2\");                // 양방향 연관관계 설정 \t\t    member2.setTeam(team1); // 연관 관계 설정 member2 -&gt; team1  \t\t\tteam1.getMemberList.add(member2); // 연관 관계 설정 team1 -&gt; member2  \t\t\tem.persist(member2);    &#125;\n\n5.2 연관관계 편의 메서드12member1.setTeam(team1); // 연관 관계 설정 member1 -&gt; team1team1.getMemberList.add(member1); // 연관 관계 설정 team1 -&gt; member1\n\n양방향 관계에서는 위 두 코드를, 다음과 같이 하나인 것처럼 사용하는 것이 안전합니다.\n123456789public class Member&#123;    private Team team;    public void setTeam(Team team)&#123;    this.team = team;    team.getMemberList().add(this);  &#125;&#125;\n\n따라서 다음과 같이 양방향 관계를 설정할 수 있습니다.\n123456789101112131415161718192021222324public void test()&#123;  \t\t\t// 팀1 저장        Team team1 = new Team();        team1.setId(\"team1\");        team1.setName(\"팀1\");        em.persist(tema1);        Member member1 = new Member();        member1.setId(\"member1\");        member1.setUsername(\"회원1\");    \t\t\t// 양방향 연관관계 설정 \t\t    member1.setTeam(team1);   \t\t\tem.persist(member1);        Member member2 = new Member();        member2.setId(\"member2\");        member2.setUsername(\"회원2\");                // 양방향 연관관계 설정 \t\t    member2.setTeam(team1); // 연관 관계 설정 member2 -&gt; team1  \t\t\tem.persist(member2);    &#125;\n\n5.3 연관관계 편의 메서드 작성시 주의 사항123member.setTeam(teamA);member.setTeam(teamB);Member findMember = teaA.getMember(); //member1이 여전히 조회\n\n이는, teamB로 변경할 때, teamA -&gt; member 관계를 제거 하지 않았기 때문입니다. 따라서 편의 메서드를 다음과 같이 수정해야 합니다.\n12345678910public void setTeam(Team team)&#123;    // 기존 팀과 관계를 제거  if(this.team != null)&#123;    this.team.getMemberList.remove(this);  &#125;    this.team = team1; // 연관 관계 설정 member -&gt; team  team.getMemberList.add(this); // 연관 관계 설정 team -&gt; member&#125;\n\nReference자바 ORM 표준 프로그래밍 &lt;김영한&gt;\n","dateCreated":"2019-03-26T00:00:00+09:00","dateModified":"2019-04-06T14:03:34+09:00","datePublished":"2019-03-26T00:00:00+09:00","description":"","headline":"[자바 ORM 표준 JPA 프로그래밍] 5장_연관관계 매핑 기초","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://kojunhee.github.io/2019/03/26/basic-relation-mapping/"},"publisher":{"@type":"Organization","name":"junhee.ko","sameAs":["https://github.com/kojunhee","https://facebook.com/kojunheee","https://www.linkedin.com/in/junheeko","mailto:junheee.ko@gmail.com"],"image":"profile.jpg","logo":{"@type":"ImageObject","url":"profile.jpg"}},"url":"https://kojunhee.github.io/2019/03/26/basic-relation-mapping/"}</script>
    <meta name="description" content="이번 포스팅에서는 객체의 참조와 테이블의 외래키를 매핑하는 것을 다룹니다.  1. 단방향 연관관계회원과 팀의 다대일 단방향 관계 (맴버-&amp;gt;팀) 를 생각해봅시다.  객체 연관 관계 회원은 Member.team 필드를 통해서 팀을 알 수 있습니다. 팀은 회원을 알 수 없습니다.   테이블 연관 관계 회원 테이블은 TEAM_ID 외래 키로 팀 테이블과 연관">
<meta property="og:type" content="blog">
<meta property="og:title" content="[자바 ORM 표준 JPA 프로그래밍] 5장_연관관계 매핑 기초">
<meta property="og:url" content="https://kojunhee.github.io/2019/03/26/basic-relation-mapping/index.html">
<meta property="og:site_name" content="junhee.ko">
<meta property="og:description" content="이번 포스팅에서는 객체의 참조와 테이블의 외래키를 매핑하는 것을 다룹니다.  1. 단방향 연관관계회원과 팀의 다대일 단방향 관계 (맴버-&amp;gt;팀) 를 생각해봅시다.  객체 연관 관계 회원은 Member.team 필드를 통해서 팀을 알 수 있습니다. 팀은 회원을 알 수 없습니다.   테이블 연관 관계 회원 테이블은 TEAM_ID 외래 키로 팀 테이블과 연관">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-04-06T05:03:34.116Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[자바 ORM 표준 JPA 프로그래밍] 5장_연관관계 매핑 기초">
<meta name="twitter:description" content="이번 포스팅에서는 객체의 참조와 테이블의 외래키를 매핑하는 것을 다룹니다.  1. 단방향 연관관계회원과 팀의 다대일 단방향 관계 (맴버-&amp;gt;팀) 를 생각해봅시다.  객체 연관 관계 회원은 Member.team 필드를 통해서 팀을 알 수 있습니다. 팀은 회원을 알 수 없습니다.   테이블 연관 관계 회원 테이블은 TEAM_ID 외래 키로 팀 테이블과 연관">
    
    
        
    
    
        <meta property="og:image" content="https://kojunhee.github.io/assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">junhee.ko</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">junhee.ko</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Always Learning</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/kojunhee" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://facebook.com/kojunheee" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/junheeko" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:junheee.ko@gmail.com" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            [자바 ORM 표준 JPA 프로그래밍] 5장_연관관계 매핑 기초
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-03-26T00:00:00+09:00">
	
		    Mar 26, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/jpa/">JPA</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>이번 포스팅에서는 객체의 참조와 테이블의 외래키를 매핑하는 것을 다룹니다. </p>
<h4 id="1-단방향-연관관계"><a href="#1-단방향-연관관계" class="headerlink" title="1. 단방향 연관관계"></a>1. 단방향 연관관계</h4><p>회원과 팀의 다대일 단방향 관계 (맴버-&gt;팀) 를 생각해봅시다.</p>
<ul>
<li>객체 연관 관계<ul>
<li>회원은 Member.team 필드를 통해서 팀을 알 수 있습니다.</li>
<li>팀은 회원을 알 수 없습니다.</li>
</ul>
</li>
<li>테이블 연관 관계<ul>
<li>회원 테이블은 TEAM_ID 외래 키로 팀 테이블과 연관관계를 맺습니다.</li>
<li>회원 테이블과 팀 테이블은 양향관 관계입니다. 회원 테이블은 TEAM_ID 외래 키로 MEMBER JOIN TEAM 과 TEAM JOIN MEMBER 둘 다 가능합니다.</li>
</ul>
</li>
<li>개체 연관관계와 테이블 연관관계의 가장 큰 차이<ul>
<li>참조를 사용하는 객체의 연관관계는 언제나 단방향 입니다. 객체를 양방향으로 참조하려면 단방향 연관관계 2개를 만들어야합니다.</li>
<li>테이블은 외래 키 하나로 양방향으로 조인할 수 있습니다.</li>
</ul>
</li>
</ul>
<h5 id="1-1-객체-관계-매핑"><a href="#1-1-객체-관계-매핑" class="headerlink" title="1.1 객체 관계 매핑"></a>1.1 객체 관계 매핑</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 연관관계 매핑</span></span><br><span class="line">    <span class="meta">@ManyToOne</span> <span class="comment">// 회원관 팀은 다대일 관계</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name = <span class="string">"TEAM_ID"</span>) <span class="comment">//외래 키를 매핑할 때 사용. name 속성에는 매핑할 외래키 이름.</span></span><br><span class="line">    <span class="keyword">private</span> Team team;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 연관관계 설정</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.team = team;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter, Setter ..</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column</span> (name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter, Setter ..</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="2-연관관계-사용"><a href="#2-연관관계-사용" class="headerlink" title="2. 연관관계 사용"></a>2. 연관관계 사용</h4><p>연관 관계를 등록, 수정, 삭제, 조회하는 예제를 통해 연관관계를 어떻게 사용하는지 확인합니다.</p>
<h5 id="2-1-저장"><a href="#2-1-저장" class="headerlink" title="2.1 저장"></a>2.1 저장</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="comment">// 팀 1 저장</span></span><br><span class="line">      Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">      team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">      team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line"></span><br><span class="line">      <span class="comment">// 회원 1 저장</span></span><br><span class="line">      Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">      member1.setTeam(team1);</span><br><span class="line">      em.persist(member1); <span class="comment">// 연관관계 설정 member1 -&gt; team1</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">// 회원 2 저장</span></span><br><span class="line">      Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">      member2.setTeam(team1);</span><br><span class="line">      em.persist(member2); <span class="comment">// 연관관계 설정 member2 -&gt; team1</span></span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-2-조회"><a href="#2-2-조회" class="headerlink" title="2.2 조회"></a>2.2 조회</h5><p>조회 방법은 두 가지 입니다.</p>
<ul>
<li>객체 그래프 탐색<ul>
<li>memebr.getTeam();</li>
</ul>
</li>
<li>JPQL<ul>
<li>select m from Member m join m.team t where t.name=:teamName</li>
<li>:로 시작하는 것은 파라미터를 바인딩하는 문법입니다.</li>
</ul>
</li>
</ul>
<h5 id="2-3-수정"><a href="#2-3-수정" class="headerlink" title="2.3 수정"></a>2.3 수정</h5><p>수정은 update() 가 없습니다. 불러온 엔티티의 값만 변경하면 트렌잭션을 커밋할 때, flush 가 일어나면서 변경 감지 기능이 작동합니다. </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">// 새로운 팀2</span></span><br><span class="line">        Team team2 = <span class="keyword">new</span> Team();</span><br><span class="line">        em.persist(team2);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 회원1에 새로운 팀2 설정</span></span><br><span class="line">        Member member = em.find(Member.class, <span class="string">"member1"</span>);</span><br><span class="line">        member.setTeam(team2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-4-제거"><a href="#2-4-제거" class="headerlink" title="2.4 제거"></a>2.4 제거</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Member member = em.find(Member.class, <span class="string">"member1"</span>);</span><br><span class="line">        member.setTeam(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="2-5-삭제"><a href="#2-5-삭제" class="headerlink" title="2.5 삭제"></a>2.5 삭제</h5><p>기존에 있던 연관관계르ㅓㄹ 먼저 제거하여 삭제해야합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">member1.setTeam(<span class="keyword">null</span>); <span class="comment">// 회원1 연관관계 제거</span></span><br><span class="line">member2.setTeam(<span class="keyword">null</span>); <span class="comment">// 회원2 연관관계 제거</span></span><br><span class="line">em.remov(team); <span class="comment">// 팀삭제</span></span><br></pre></td></tr></table></figure>

<h4 id="3-양방향-연관관계"><a href="#3-양방향-연관관계" class="headerlink" title="3. 양방향 연관관계"></a>3. 양방향 연관관계</h4><p>회원에서 팀으로 접근하고, 반대 방향인 팀에서도 회원으로 접근하도록 합니다.</p>
<h5 id="3-1-양방향-연관관계-매핑"><a href="#3-1-양방향-연관관계-매핑" class="headerlink" title="3.1 양방향 연관관계 매핑"></a>3.1 양방향 연관관계 매핑</h5><p>회원 엔티티는 변경이 없습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column</span>(name = <span class="string">"MEMBER_ID"</span>)</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 연관관계 매핑</span></span><br><span class="line">    <span class="meta">@ManyToOne</span></span><br><span class="line">    <span class="meta">@JoinColumn</span>(name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">    <span class="keyword">private</span> Team team;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 연관관계 설정</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.team = team;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter, Setter ..</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>팀 엔티티에 Member list 를 추가했습니다. 그리고 일대다 관계를 매핑하기 위해 @OneToMany 를 설정했습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Team</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column</span> (name = <span class="string">"TEAM_ID"</span>)</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany</span> (mappedBy = <span class="string">"team"</span>)</span><br><span class="line">    <span class="keyword">private</span> List&lt;Member&gt; memberList = <span class="keyword">new</span> ArrayList&lt;Member&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// Getter, Setter ..</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="4-연관관계의-주인"><a href="#4-연관관계의-주인" class="headerlink" title="4. 연관관계의 주인"></a>4. 연관관계의 주인</h4><p>엔티티를 양방향 연관관계로 설정하면 객체의 참조는 둘인데, 외래 키는 하나입니다. 이런 차이로 인해 JPA 는 두 객체 연관관계 중 하나를 정해서 테이블의 외래키를 관리해야 하는데 이것을 연관관계의 주인이라고 합니다.</p>
<h5 id="4-1-양방향-매칭의-규칙-연관관계의-주인"><a href="#4-1-양방향-매칭의-규칙-연관관계의-주인" class="headerlink" title="4.1 양방향 매칭의 규칙 : 연관관계의 주인"></a>4.1 양방향 매칭의 규칙 : 연관관계의 주인</h5><p>연관계의 주인만이 데이터베이스 연관관계와 매핑되고, 외래 키를 관리 할 수 있습니다. 주인이 아닌 쪽은 읽기만 가능합니다. 연관관계의 주인을 정한다는 것은 외래 키 관리자를 선택한다는 것입니다.</p>
<h5 id="4-2-연관-관계의-주인은-외래-키가-있는-곳"><a href="#4-2-연관-관계의-주인은-외래-키가-있는-곳" class="headerlink" title="4.2 연관 관계의 주인은 외래 키가 있는 곳"></a>4.2 연관 관계의 주인은 외래 키가 있는 곳</h5><p>데이터베이스 테이블의 다대일, 일대다 관계에서는 항상 다 쪽이 외래키를 가집니다. 따라서, 다 쪽인 @ManyToOne 은 항상 연관계의 주인이므로 mappedBy 속성을 설정할 수 없습니다.</p>
<h4 id="5-양방향-연관관계의-주의점"><a href="#5-양방향-연관관계의-주의점" class="headerlink" title="5. 양방향 연관관계의 주의점"></a>5. 양방향 연관관계의 주의점</h4><p>연관관계의 주인에는 값을 입력하지 않고, 주인이 아닌 곳에만 값을 입력하는 경우를 봅시다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">save</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 회원 1 저장</span></span><br><span class="line">       Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">       em.persist(member1); <span class="comment">// 연관관계 설정 member1 -&gt; team1</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">// 회원 2 저장</span></span><br><span class="line">       Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">       em.persist(member2); <span class="comment">// 연관관계 설정 member2 -&gt; team1</span></span><br><span class="line">       </span><br><span class="line">       Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">       team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">       team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line">       </span><br><span class="line">       <span class="comment">//주인이 아닌 곳에만 연관관계 설정</span></span><br><span class="line">       team1.getMemberList().add(member1)</span><br><span class="line">       team1.getMemberList().add(member2)</span><br><span class="line"></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>데이터베이스에서 회원테이블을 조회해 봅시다. </p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">MEMBER</span>;</span><br><span class="line"></span><br><span class="line">//결과</span><br><span class="line">Memer_ID / USERNAME / TEAM_ID</span><br><span class="line">member1 / 회원 1 / null</span><br><span class="line">member2 / 회원 2 / null</span><br></pre></td></tr></table></figure>

<h5 id="5-1-순수한-객체까지-고려한-양방향-연관관계"><a href="#5-1-순수한-객체까지-고려한-양방향-연관관계" class="headerlink" title="5.1 순수한 객체까지 고려한 양방향 연관관계"></a>5.1 순수한 객체까지 고려한 양방향 연관관계</h5><p>JPA를 사용하지 않고 순수한 객체로 테스트해 봅시다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">       Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">       team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">       team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line"></span><br><span class="line">       Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">       member1.setId(<span class="string">"member1"</span>);</span><br><span class="line">       member1.setUsername(<span class="string">"회원1"</span>);</span><br><span class="line"></span><br><span class="line">       Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">       member2.setId(<span class="string">"member2"</span>);</span><br><span class="line">       member2.setUsername(<span class="string">"회원2"</span>);</span><br><span class="line">       </span><br><span class="line">       member1.setTeam(team1); <span class="comment">// 연관 관계 설정 member1 -&gt; team1</span></span><br><span class="line">       member2.setTeam(team1); <span class="comment">// 연관 관계 설정 member2 -&gt; team1</span></span><br><span class="line"></span><br><span class="line">       List&lt;Member&gt; memberList = team1.getMemberList();</span><br><span class="line">       System.out.println(<span class="string">"member size : "</span> + memberList.size()); <span class="comment">// 출력 결과 : 0</span></span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<p>회원 -&gt; 팀 을 설정하면 다음 코드 처럼 반대 방향인 팀 -&gt; 회원도 설정해야합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">        Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">        team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">        team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line"></span><br><span class="line">        Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">        member1.setId(<span class="string">"member1"</span>);</span><br><span class="line">        member1.setUsername(<span class="string">"회원1"</span>);</span><br><span class="line"></span><br><span class="line">        Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">        member2.setId(<span class="string">"member2"</span>);</span><br><span class="line">        member2.setUsername(<span class="string">"회원2"</span>);</span><br><span class="line">        </span><br><span class="line">        member1.setTeam(team1); <span class="comment">// 연관 관계 설정 member1 -&gt; team1</span></span><br><span class="line">  			team1.getMemberList.add(member1); <span class="comment">// 연관 관계 설정 team1 -&gt; member1</span></span><br><span class="line">  </span><br><span class="line">        member2.setTeam(team1); <span class="comment">// 연관 관계 설정 member2 -&gt; team1</span></span><br><span class="line">    		team1.getMemberList.add(member2); <span class="comment">// 연관 관계 설정 team1 -&gt; member2</span></span><br><span class="line"></span><br><span class="line">        List&lt;Member&gt; memberList = team1.getMemberList();</span><br><span class="line">        System.out.println(<span class="string">"member size : "</span> + memberList.size()); <span class="comment">// 출력 결과 : 2</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>JPA를 적용하면 다음과 같습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  			<span class="comment">// 팀1 저장</span></span><br><span class="line">        Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">        team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">        team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line">        em.persist(tema1);</span><br><span class="line"></span><br><span class="line">        Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">        member1.setId(<span class="string">"member1"</span>);</span><br><span class="line">        member1.setUsername(<span class="string">"회원1"</span>);</span><br><span class="line">  </span><br><span class="line">  			<span class="comment">// 양방향 연관관계 설정</span></span><br><span class="line"> 		    member1.setTeam(team1); <span class="comment">// 연관 관계 설정 member1 -&gt; team1</span></span><br><span class="line">  			team1.getMemberList.add(member1); <span class="comment">// 연관 관계 설정 team1 -&gt; member1</span></span><br><span class="line">  			em.persist(member1);</span><br><span class="line"></span><br><span class="line">        Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">        member2.setId(<span class="string">"member2"</span>);</span><br><span class="line">        member2.setUsername(<span class="string">"회원2"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 양방향 연관관계 설정</span></span><br><span class="line"> 		    member2.setTeam(team1); <span class="comment">// 연관 관계 설정 member2 -&gt; team1</span></span><br><span class="line">  			team1.getMemberList.add(member2); <span class="comment">// 연관 관계 설정 team1 -&gt; member2</span></span><br><span class="line">  			em.persist(member2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-2-연관관계-편의-메서드"><a href="#5-2-연관관계-편의-메서드" class="headerlink" title="5.2 연관관계 편의 메서드"></a>5.2 연관관계 편의 메서드</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">member1.setTeam(team1); <span class="comment">// 연관 관계 설정 member1 -&gt; team1</span></span><br><span class="line">team1.getMemberList.add(member1); <span class="comment">// 연관 관계 설정 team1 -&gt; member1</span></span><br></pre></td></tr></table></figure>

<p>양방향 관계에서는 위 두 코드를, 다음과 같이 하나인 것처럼 사용하는 것이 안전합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Member</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">private</span> Team team;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.team = team;</span><br><span class="line">    team.getMemberList().add(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>따라서 다음과 같이 양방향 관계를 설정할 수 있습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">  			<span class="comment">// 팀1 저장</span></span><br><span class="line">        Team team1 = <span class="keyword">new</span> Team();</span><br><span class="line">        team1.setId(<span class="string">"team1"</span>);</span><br><span class="line">        team1.setName(<span class="string">"팀1"</span>);</span><br><span class="line">        em.persist(tema1);</span><br><span class="line"></span><br><span class="line">        Member member1 = <span class="keyword">new</span> Member();</span><br><span class="line">        member1.setId(<span class="string">"member1"</span>);</span><br><span class="line">        member1.setUsername(<span class="string">"회원1"</span>);</span><br><span class="line">  </span><br><span class="line">  			<span class="comment">// 양방향 연관관계 설정</span></span><br><span class="line"> 		    member1.setTeam(team1); </span><br><span class="line">  			em.persist(member1);</span><br><span class="line"></span><br><span class="line">        Member member2 = <span class="keyword">new</span> Member();</span><br><span class="line">        member2.setId(<span class="string">"member2"</span>);</span><br><span class="line">        member2.setUsername(<span class="string">"회원2"</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 양방향 연관관계 설정</span></span><br><span class="line"> 		    member2.setTeam(team1); <span class="comment">// 연관 관계 설정 member2 -&gt; team1</span></span><br><span class="line">  			em.persist(member2);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h5 id="5-3-연관관계-편의-메서드-작성시-주의-사항"><a href="#5-3-연관관계-편의-메서드-작성시-주의-사항" class="headerlink" title="5.3 연관관계 편의 메서드 작성시 주의 사항"></a>5.3 연관관계 편의 메서드 작성시 주의 사항</h5><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">member.setTeam(teamA);</span><br><span class="line">member.setTeam(teamB);</span><br><span class="line">Member findMember = teaA.getMember(); <span class="comment">//member1이 여전히 조회</span></span><br></pre></td></tr></table></figure>

<p>이는, teamB로 변경할 때, teamA -&gt; member 관계를 제거 하지 않았기 때문입니다. 따라서 편의 메서드를 다음과 같이 수정해야 합니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTeam</span><span class="params">(Team team)</span></span>&#123;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// 기존 팀과 관계를 제거</span></span><br><span class="line">  <span class="keyword">if</span>(<span class="keyword">this</span>.team != <span class="keyword">null</span>)&#123;</span><br><span class="line">    <span class="keyword">this</span>.team.getMemberList.remove(<span class="keyword">this</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">this</span>.team = team1; <span class="comment">// 연관 관계 설정 member -&gt; team</span></span><br><span class="line">  team.getMemberList.add(<span class="keyword">this</span>); <span class="comment">// 연관 관계 설정 team -&gt; member</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="Reference"><a href="#Reference" class="headerlink" title="Reference"></a>Reference</h4><p>자바 ORM 표준 프로그래밍 &lt;김영한&gt;</p>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/03/27/relation-mappings/" data-tooltip="[자바 ORM 표준 JPA 프로그래밍] 6장_다양한 연관관계 매핑" aria-label="PREVIOUS: [자바 ORM 표준 JPA 프로그래밍] 6장_다양한 연관관계 매핑">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/03/20/persistence context/" data-tooltip="[자바 ORM 표준 JPA 프로그래밍] 3장_영속성 관리" aria-label="NEXT: [자바 ORM 표준 JPA 프로그래밍] 3장_영속성 관리">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://kojunhee.github.io/2019/03/26/basic-relation-mapping/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 junhee.ko. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/03/27/relation-mappings/" data-tooltip="[자바 ORM 표준 JPA 프로그래밍] 6장_다양한 연관관계 매핑" aria-label="PREVIOUS: [자바 ORM 표준 JPA 프로그래밍] 6장_다양한 연관관계 매핑">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/03/20/persistence context/" data-tooltip="[자바 ORM 표준 JPA 프로그래밍] 3장_영속성 관리" aria-label="NEXT: [자바 ORM 표준 JPA 프로그래밍] 3장_영속성 관리">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://kojunhee.github.io/2019/03/26/basic-relation-mapping/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="2">
    <i id="btn-close-shareoptions" class="fa fa-times"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://kojunhee.github.io/2019/03/26/basic-relation-mapping/">
                    <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">junhee.ko</h4>
        
            <div id="about-card-bio"><p>Always Learning</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Engineer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Incheon
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->

    
        <script>
             var disqus_config = function () {
                 this.page.url = 'https://kojunhee.github.io/2019/03/26/basic-relation-mapping/';
                 
                    this.page.identifier = '2019/03/26/basic-relation-mapping/';
                 
             };
            (function() {
                var d = document, s = d.createElement('script');
                var disqus_shortname = 'junheeko';
                s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    



    </body>
</html>
