<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="utf-8">
  
  
  <title>[자바 ORM 표준 JPA 프로그래밍] 11장_웹 어플리케이션 제작 | junhee.ko</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="11장은 Spring Framework 와 JPA 를 사용해서 Web Application 을 만들어보는 장입니다. 진행 순서는 다음과 같습니다.  프로젝트 환경설정 도메인 모델과 테이블 설계 기능 구현  코드 위주의 챕터이기 때문에, 핵심 키워드 위주로 정리하려고 합니다. 11.1 프로젝트 환경설정11.2 도메인 모델과 테이블 설계11.2.1 요구사항 분">
<meta property="og:type" content="article">
<meta property="og:title" content="[자바 ORM 표준 JPA 프로그래밍] 11장_웹 어플리케이션 제작">
<meta property="og:url" content="https://kojunhee.github.io/2019/06/05/web-application/index.html">
<meta property="og:site_name" content="junhee.ko">
<meta property="og:description" content="11장은 Spring Framework 와 JPA 를 사용해서 Web Application 을 만들어보는 장입니다. 진행 순서는 다음과 같습니다.  프로젝트 환경설정 도메인 모델과 테이블 설계 기능 구현  코드 위주의 챕터이기 때문에, 핵심 키워드 위주로 정리하려고 합니다. 11.1 프로젝트 환경설정11.2 도메인 모델과 테이블 설계11.2.1 요구사항 분">
<meta property="og:locale" content="en">
<meta property="og:updated_time" content="2019-06-05T12:25:25.133Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[자바 ORM 표준 JPA 프로그래밍] 11장_웹 어플리케이션 제작">
<meta name="twitter:description" content="11장은 Spring Framework 와 JPA 를 사용해서 Web Application 을 만들어보는 장입니다. 진행 순서는 다음과 같습니다.  프로젝트 환경설정 도메인 모델과 테이블 설계 기능 구현  코드 위주의 챕터이기 때문에, 핵심 키워드 위주로 정리하려고 합니다. 11.1 프로젝트 환경설정11.2 도메인 모델과 테이블 설계11.2.1 요구사항 분">
  
    <link rel="alternate" href="/atom.xml" title="junhee.ko" type="application/atom+xml">
  
  
    <link rel="icon" href="css/images/favicon.ico">
  
  
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">
  
  <link rel="stylesheet" href="/css/style.css">
  
    <link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">
  
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">junhee.ko</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">always learning</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://kojunhee.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-web-application" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2019/06/05/web-application/" class="article-date">
  <time class="dt-published" datetime="2019-06-04T15:00:00.000Z" itemprop="datePublished">2019-06-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/jpa/">JPA</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      [자바 ORM 표준 JPA 프로그래밍] 11장_웹 어플리케이션 제작
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>11장은 Spring Framework 와 JPA 를 사용해서 Web Application 을 만들어보는 장입니다. 진행 순서는 다음과 같습니다.</p>
<ol>
<li>프로젝트 환경설정</li>
<li>도메인 모델과 테이블 설계</li>
<li>기능 구현</li>
</ol>
<p>코드 위주의 챕터이기 때문에, 핵심 키워드 위주로 정리하려고 합니다.</p>
<h4 id="11-1-프로젝트-환경설정"><a href="#11-1-프로젝트-환경설정" class="headerlink" title="11.1 프로젝트 환경설정"></a>11.1 프로젝트 환경설정</h4><h4 id="11-2-도메인-모델과-테이블-설계"><a href="#11-2-도메인-모델과-테이블-설계" class="headerlink" title="11.2 도메인 모델과 테이블 설계"></a>11.2 도메인 모델과 테이블 설계</h4><h5 id="11-2-1-요구사항-분석"><a href="#11-2-1-요구사항-분석" class="headerlink" title="11.2.1 요구사항 분석"></a>11.2.1 요구사항 분석</h5><ul>
<li><p>회원 기능</p>
<ul>
<li>등록</li>
<li>조회</li>
</ul>
</li>
<li><p>상품 기능</p>
<ul>
<li>등록</li>
<li>수정</li>
<li>조회</li>
</ul>
</li>
<li><p>주문</p>
<ul>
<li>주문</li>
<li>조회</li>
<li>취소</li>
</ul>
</li>
<li><p>기타</p>
<ul>
<li>상품 종류 : 도서 / 음반 / 영화</li>
<li>상품은 카테고리로 구분 가능</li>
<li>상품 주문 시 배송 정보 입력 가능</li>
</ul>
</li>
</ul>
<h5 id="11-2-2-도메인-모델-설계"><a href="#11-2-2-도메인-모델-설계" class="headerlink" title="11.2.2 도메인 모델 설계"></a>11.2.2 도메인 모델 설계</h5><ul>
<li>회원 / 주문 / 상품<ul>
<li>주문과 상품은 다대다 관계<ul>
<li>다대다 관계는 관계형 데이터베이스는 물론이고, 엔티티에서도 거의 사용하지 않음</li>
<li>주문 상품이라는 엔티티를 추가해서 다다대 관계를 일대다, 다대일 관계로 풀어냄</li>
</ul>
</li>
<li>상품 분류<ul>
<li>상품은 도서, 음반, 영화로 구분되는데, 상품이라는 공통 속성을 사용하므로 상속 구조로 표현</li>
</ul>
</li>
</ul>
</li>
</ul>
<h5 id="11-2-3-테이블-설계"><a href="#11-2-3-테이블-설계" class="headerlink" title="11.2.3 테이블 설계"></a>11.2.3 테이블 설계</h5><h5 id="11-2-4-연관-관계-정리"><a href="#11-2-4-연관-관계-정리" class="headerlink" title="11.2.4 연관 관계 정리"></a>11.2.4 연관 관계 정리</h5><ul>
<li>회원과 주문<ul>
<li>일대다 양방향 관계</li>
<li>연관 관계의 주인을 정해야함. 외래키가 있는 주문이 연관 관계의 주인.</li>
</ul>
</li>
<li>주문 상품과 주문<ul>
<li>다대일 양방향 관계</li>
<li>주문 상품이 연관관계의 주인</li>
</ul>
</li>
<li>주문 상품과 상품<ul>
<li>일대일 단방향 관계</li>
</ul>
</li>
<li>주문과 배송<ul>
<li>일대일 양방향 관계</li>
</ul>
</li>
<li>카테고리와 상품<ul>
<li>@ManyToMany</li>
</ul>
</li>
</ul>
<h5 id="11-2-5-엔티티-클래스"><a href="#11-2-5-엔티티-클래스" class="headerlink" title="11.2.5 엔티티 클래스"></a>11.2.5 엔티티 클래스</h5><h4 id="11-3-애플리케이션-구현"><a href="#11-3-애플리케이션-구현" class="headerlink" title="11.3 애플리케이션 구현"></a>11.3 애플리케이션 구현</h4><h5 id="11-3-1-개발-방법"><a href="#11-3-1-개발-방법" class="headerlink" title="11.3.1 개발 방법"></a>11.3.1 개발 방법</h5><ul>
<li>Controller<ul>
<li>MVC 의 컨트롤러가 모여있는 곳</li>
<li>서비스 계층을 호출하고 결과를 뷰에 전달</li>
</ul>
</li>
<li>Service<ul>
<li>비즈니스 로직이 있고 트렌젝션을 시작</li>
<li>데이터 접근 계층인 Repository를 호출</li>
</ul>
</li>
<li>Repository<ul>
<li>JPA 를 직접 사용하는 곳</li>
<li>Entity Manager 를 사용해서 Entity 를 저장하고 조회</li>
</ul>
</li>
<li>Domain<ul>
<li>엔티티가 모여 있는 계층</li>
<li>모든 계층에서 사용</li>
</ul>
</li>
</ul>
<h5 id="11-3-2-회원-기능"><a href="#11-3-2-회원-기능" class="headerlink" title="11.3.2 회원 기능"></a>11.3.2 회원 기능</h5><p>순수 자바 환경에셔는 엔티티 메니저 팩토리에서 엔티티 메니저를 직접 생성해서 사용했지만, 스프링이나 J2EE 컨테이너를 사용하면 컨테이너가 엔티티 메니저를 관리하고 제공합니다. 그래서, 엔티티 메니저 팩토리에서 엔티티 메니저를 직접 생성해서 사용하지 않고, 컨테이너가 제공하는 엔티티 메니저를 사용합니다.</p>
<p>@PersistenceContext 는 컨테이너가 관리하는 엔티티 메니저를 주입하는 Annotation 입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PersistenceContext</span></span><br><span class="line">EntityManager em;</span><br></pre></td></tr></table></figure>

<h5 id="11-3-3-상품-기능"><a href="#11-3-3-상품-기능" class="headerlink" title="11.3.3 상품 기능"></a>11.3.3 상품 기능</h5><h5 id="11-3-4-주문-기능"><a href="#11-3-4-주문-기능" class="headerlink" title="11.3.4 주문 기능"></a>11.3.4 주문 기능</h5><p>주문 서비스의 주문과 주문 취소 메소드를 보면 비즈니스 로직 대부분이 엔티티에 있습니다. 서비스 계층은 단순히 엔티티에 필요한 요청을 위임하는 역할을 합니다. 이처럼, 엔티티가 비즈니로스 로직을 가지고 객체지향의 특성을 활용하는 것을 도메인 모델 패턴이라고 합니다.</p>
<p>반대로, 엔티티에는 비즈니스 로직이 거의 없고 서비스 계층에서 대부분의 비즈니스 로직을 처리하는 것을 트랜잭션 스크립트 패턴이라고 합니다. </p>
<h5 id="11-3-5-웹-계층-구현"><a href="#11-3-5-웹-계층-구현" class="headerlink" title="11.3.5 웹 계층 구현"></a>11.3.5 웹 계층 구현</h5><p>준영속 엔티티를 수정하는 방법은 2가지입니다.</p>
<ul>
<li>변경 감지 기능 사용</li>
<li>병합 사용</li>
</ul>
<p>변경 감지 기능을 사용하는 방법은, 영속성 컨텍스트에서 엔티티를 다시 조회한 후에 데이터를 수정하는 방법입니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="comment">//itemParam : Parameter 로 넘어온 준영속 상태의 엔티티</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Item itemParam)</span></span>&#123;</span><br><span class="line">  <span class="comment">//같은 엔티티를 조회</span></span><br><span class="line">  Item findItem = em.find(Item.class, itemParam.getId());</span><br><span class="line">  </span><br><span class="line">  findItem.setPrice(itemParam.getPrice()); <span class="comment">//데이터 수정</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>위 코드처럼, 트렌젝션 안에서 준영속 엔티티의 식별자로 엔티티를 다시 조회하면, 영속 상태의 엔티티를 얻을 수 있습니다. 이렇게 영속 상태인 엔티티의 값을 파라미터로 넘어온 준영속 사앹의 엔티티 값으로 변경하면 됩니다. 이렇게 하면, 이후 트렌젝션이 커밋될때 변경감지 기능이 동작해서 데이터베이스에 수정사항이 반영됩니다.</p>
<p>병합은 파라미터로 넘긴 준영속 엔티티의 식별자 값으로 영속 엔티티를 조회하고, 영속 엔티티의 값을 준영속 엔티티의 값으로 채워넣습니다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="comment">//itemParam : Parameter 로 넘어온 준영속 상태의 엔티티</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">update</span><span class="params">(Item itemParam)</span></span>&#123;</span><br><span class="line">  Item mergeItem = em.merge(itemParam);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>변경 감지 기능을 사용하면, 원하는 속성만 선택해서 변경할 수 있지만, 병합을 사용하면 모든 속성이 변경됩니다.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://kojunhee.github.io/2019/06/05/web-application/" data-id="ck71wv6tm00m60b6w14lthors" data-title="[자바 ORM 표준 JPA 프로그래밍] 11장_웹 어플리케이션 제작" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2019/06/12/web-application-persistencen-context/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          [자바 ORM 표준 JPA 프로그래밍] 13장_웹 어플리케이션과 영속성 관리
        
      </div>
    </a>
  
  
    <a href="/2019/04/21/spring-data-jpa/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">[자바 ORM 표준 JPA 프로그래밍] 12장_스프링 데이터 JPA</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/big-data/">Big Data</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/boost-course/">Boost Course</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/dip/">DIP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/data-structure/">Data Structure</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/database/">Database</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/design-pattern/">Design Pattern</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/git/">Git</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/jpa/">JPA</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/java/">Java</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/kafka/">Kafka</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/network/">Network</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/node-js/">Node.js</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/os/">OS</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/object/">Object</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/software-engineering/">Software Engineering</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/spark/">Spark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tdd/">TDD</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/etc/">etc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ios/">iOS</a></li></ul>
    </div>
  </div>


  
    

  
    
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/06/">June 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/03/">March 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/02/">February 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/01/">January 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/12/">December 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/11/">November 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/10/">October 2017</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2017/09/">September 2017</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2020/02/25/bigdata-chapter-01/">[빅데이터] 1장_빅데이터를 위한 새로운 패러다임</a>
          </li>
        
          <li>
            <a href="/2020/02/24/tdd-chapter-03/">[테스트 주도 개발] 3장_모두를 위한 평등</a>
          </li>
        
          <li>
            <a href="/2020/02/24/tdd-chapter-02/">[테스트 주도 개발] 2장_타락한 객체</a>
          </li>
        
          <li>
            <a href="/2020/02/24/tdd-chapter-01/">[테스트 주도 개발] 1장_다중 통화를 지원하는 Money 객체</a>
          </li>
        
          <li>
            <a href="/2020/02/10/object-chapter-appendix-c/">[오브젝트] 부록 C 동적인 협력, 정적인 코드</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2020 junhee.ko<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="/js/jquery-3.4.1.min.js"></script>


  <script src="/fancybox/jquery.fancybox.min.js"></script>


<script src="/js/script.js"></script>




  </div>
</body>
</html>