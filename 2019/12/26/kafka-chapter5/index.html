
<!DOCTYPE html>
<html lang="en">
    
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="junhee.ko">
    <title>[카프카] 5장_카프카 컨슈머 - junhee.ko</title>
    <meta name="author" content="junhee.ko">
    
    
    
    <script type="application/ld+json">{"@context":"http://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"junhee.ko","sameAs":["https://github.com/kojunhee","https://facebook.com/kojunheee","https://www.linkedin.com/in/junheeko","mailto:junheee.ko@gmail.com"],"image":"profile.jpg"},"articleBody":"컨슈머란, 프로듀서가 메세지를 생산해서 카프카의 토픽으로 보내면 그 토픽의 메세지를 가져와 소비하는 애플리케이션, 서버이다.\n주요 기능은, 특정 파티션을 관리하고 있는 파티션 리더에게 메세지를 가져오기 요청을 하는 것이다.\n2. 콘솔 컨슈머로 메세지 가져오기컨슈머를 실행할 때는 항상 컨슈머 그룹이 필요하다. \n만약 추가 옵션을 주지 않고 실행하면, 자동으로 다음 형태로 컨슈머 그룹이 생성된다.\n1console-consumer-xxxx(숫자)\n\n4. 파티션과 메세지 순서4.1 파티션 3개로 구성한 토픽과 메세지 순서프로듀서 다음 순서로 보낸다.\n12345abcde\n\n컨슈머에서 –from-beginning 옵션으로 받는다. \n메세지의 순서가 프로듀서가 보낸 순서가 아니다.\n12345adbec\n\n다음으로, 프로듀서서가 숫자를 보낸다.\n1234512345\n\n컨슈머에서 –from-beginning 옵션으로 받는다. \n12345678910ad14be25c3\n\n위 현상들은 정상이다.\n–partition 0, –partition 1, –partition 3 로 각각 옵션을 주어서 컨슈머를 각각 실행해보면,\n1234be25\n\n1234ad14\n\n12c3\n\n\n프로듀서가 메세지를 a b c d e 순서로 보냈지만, 해당 메세지들은 하나의 파티션에만 순서대로 저장되는 것이 아니라 각각의 파티션별로 메세지가 저장되었다. \n컨슈머의 출력 내용은 각 파티션의 오프셋 순서대로 메세지를 가져온 것이다.\n즉, \n\n카프카 컨슈머에서의 메세지 순서는 동일한 파티션 내에서는 프로듀서가 생성한 순서와 동일하게 처리하지만, \n파티션과 파티션 사이에서는 순서를 보장하지 않는다.\n\n4.2 파티션 1개로 구성한 토픽과 메세지 순서메세지 순서를 정확하게 보장받기 위해서는 토픽 파티션 수를 1로 지정하면 된다.\n단점은, \n\n분산해서 처리할 수 없고 \n하나의 컨슈머에서만 처리할 수 있기 때문에 처리량이 낮다.\n\n5. 컨슈머 그룹동일한 토픽에 대해 여러 컨슈머가 메세지를 가져갈 수 있도록 컨슈머 그룹이라는 기능을 제공한다. \n이 방식은, 최근에 하나의 데이터를 다양한 용도로 사용하는 요구가 많아져서 좋다.\n\n\n 위 그림에서, 갑자기 프로듀서가 해당 토픽으로 많은 메세지를 전송한다고 가정해보자. \n\n프로듀서가 메세지를 보내는 속도가 컨슈머가 메세지를 가져가는 속도보다 빨라서, 컨슈머가 읽어가지 못하는 메세지들이 쌓인다.\n그래서 다음과 같이 컨슈머를 확장한다.\n\n컨슈머 그룹 안에서는 컨슈머들이 메세지를 가져오고 있는 토픽의 파티션에 대한 소유권을 공유한다. \n파티션 1 의 소유권이 컨슈머 01 에서 02 로, 파티션 2 의 소유권이 컨슈머 01 에서 03 으로 이동했다.\n이렇게 소유권이 이동하는 것을 리밸런스 라고 한다.\n리밸런스의 단점은, 리밸런스 하는 동안 일시적으로 컨슈머는 메세지를 가져올 수 없다는 것이다.\n\n그런데, 이렇게 컨슈머를 추가했음에도 컨슈머가 가져가야하는 메세지가 쌓이면 어떻게 해야할까 ?\n\n컨슈머 04 를 추가해보자. 그대로다.\n왜냐하면, 토픽의 파티션에는 하나의 컨슈머만 연결할 수 있기 때문이다. 각각의 파티션에 대해서는 메세지 순서를 보장하는데 두 개의 컨슈머가 하나의 파티션을 공유하면 안정적으로 메세지 순서를 보장할 수 없다.\n그래서 파티션 수도 같이 늘려줘야한다.\n\n 컨슈머 그룹에서 컨슈머 04 가 다운되는 경우를 살펴보자.\n\n컨슈머가 컨슈머 그룹 안에서 멤버로 유지하고 할당된 파티션의 소유권을 유지하는 방법은 하트비트를 보내는 것이다. \n만약, 커슈머가 오랫동안 하트비트를 보내지 않으면 세션은 타임아웃 되고 해당 커슈머가 다운되었다고 판단해서 리밸런스가 시작된다.\n컨슈머 04 가 다운되면서 컨슈머 04 가 담당하던 파티션 3 을 컨슈머 03 이 이어받는다. \n6. 커밋과 오프셋컨슈머가 poll() 을 호출할 때마다 컨슈머 그룹은 카프카에 저장되어 있는 아직 읽지 않는 메세지를 가져온다. \n이것이 가능한 이유는, 컨슈머 그룹이 어디까지 메세지를 가져갔는지 알 수 있기 때문이다.\n컨슈머 그룹의 각각 컨슈머들은 각각의 파티션에 자신이 가져간 메세지의 위치 정보인 오프셋을 기록한다.\n각 파티션에 대해 현재 위치를 업데이하는 것을 커밋 이라고 한다.\n\n올드 카프카 컨슈머 (0.9 이전 버젼)\n오프셋 정보를 주키퍼에 저장\n\n뉴 카프카 컨슈머 \n내부에서 사용하는 토픽 (_consumer_offsets) 을 만들고 이 토픽에 오프셋 정보를 저장\n\n\n6.1 자동 커밋1enable.auto.commit = true\n\n5초 마다 컨슈머가 poll() 을 호출할 때마다 가장 마지막 오프셋을 커밋한다. \n\n\n컨슈머는 한 번의 poll() 로 메세지를 1, 2 를 가져온다.\n5초가 되면서 마지막 오프셋 2 를 커밋한다.\n메세지 3 과 4를 가져온다.\n5초가 지나 오프셋 4를 커밋한다.\n\n6.2 수동 커밋메세지 처리가 완료될 때까지 메세지를 가져온 것으로 간주되어서는 안되는 경우에 사용한다. \nex ) 메세지를 컨슈머가 가져오자마자 커밋하는 것이 아니라, 데이터베이스에 메세지를 저장한 후 커밋을 한다.\n6.3 특정 파티션 할당수동으로 파티션을 할당해 메세지를 가져올 수 있다. \n6.4 특정 오프셋부터 메세지 가져오기1seek(파티션 번호, 오프셋 번호)\n\n\n카프카, 데이터 플랫폼의 최강자 &lt;고승범, 공용준&gt;\n","dateCreated":"2019-12-26T00:00:00+09:00","dateModified":"2019-12-26T18:51:36+09:00","datePublished":"2019-12-26T00:00:00+09:00","description":"","headline":"[카프카] 5장_카프카 컨슈머","image":[],"mainEntityOfPage":{"@type":"WebPage","@id":"https://kojunhee.github.io/2019/12/26/kafka-chapter5/"},"publisher":{"@type":"Organization","name":"junhee.ko","sameAs":["https://github.com/kojunhee","https://facebook.com/kojunheee","https://www.linkedin.com/in/junheeko","mailto:junheee.ko@gmail.com"],"image":"profile.jpg","logo":{"@type":"ImageObject","url":"profile.jpg"}},"url":"https://kojunhee.github.io/2019/12/26/kafka-chapter5/"}</script>
    <meta name="description" content="컨슈머란, 프로듀서가 메세지를 생산해서 카프카의 토픽으로 보내면 그 토픽의 메세지를 가져와 소비하는 애플리케이션, 서버이다. 주요 기능은, 특정 파티션을 관리하고 있는 파티션 리더에게 메세지를 가져오기 요청을 하는 것이다. 2. 콘솔 컨슈머로 메세지 가져오기컨슈머를 실행할 때는 항상 컨슈머 그룹이 필요하다.  만약 추가 옵션을 주지 않고 실행하면, 자동으로">
<meta property="og:type" content="blog">
<meta property="og:title" content="[카프카] 5장_카프카 컨슈머">
<meta property="og:url" content="https://kojunhee.github.io/2019/12/26/kafka-chapter5/index.html">
<meta property="og:site_name" content="junhee.ko">
<meta property="og:description" content="컨슈머란, 프로듀서가 메세지를 생산해서 카프카의 토픽으로 보내면 그 토픽의 메세지를 가져와 소비하는 애플리케이션, 서버이다. 주요 기능은, 특정 파티션을 관리하고 있는 파티션 리더에게 메세지를 가져오기 요청을 하는 것이다. 2. 콘솔 컨슈머로 메세지 가져오기컨슈머를 실행할 때는 항상 컨슈머 그룹이 필요하다.  만약 추가 옵션을 주지 않고 실행하면, 자동으로">
<meta property="og:locale" content="en">
<meta property="og:image" content="https://kojunhee.github.io/image/kafka_partition_message.png">
<meta property="og:image" content="https://kojunhee.github.io/image/kafka_consumer_g01.png">
<meta property="og:image" content="https://kojunhee.github.io/image/kafka_consumer_g02.png">
<meta property="og:image" content="https://kojunhee.github.io/image/kafka_auto_commit.png">
<meta property="og:updated_time" content="2019-12-26T09:51:36.572Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="[카프카] 5장_카프카 컨슈머">
<meta name="twitter:description" content="컨슈머란, 프로듀서가 메세지를 생산해서 카프카의 토픽으로 보내면 그 토픽의 메세지를 가져와 소비하는 애플리케이션, 서버이다. 주요 기능은, 특정 파티션을 관리하고 있는 파티션 리더에게 메세지를 가져오기 요청을 하는 것이다. 2. 콘솔 컨슈머로 메세지 가져오기컨슈머를 실행할 때는 항상 컨슈머 그룹이 필요하다.  만약 추가 옵션을 주지 않고 실행하면, 자동으로">
<meta name="twitter:image" content="https://kojunhee.github.io/image/kafka_partition_message.png">
    
    
        
    
    
        <meta property="og:image" content="https://kojunhee.github.io/assets/images/profile.jpg"/>
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/all.css">
    <link rel="stylesheet" href="/assets/css/jquery.fancybox.css">
    <link rel="stylesheet" href="/assets/css/thumbs.css">
    <link rel="stylesheet" href="/assets/css/tranquilpeak.css">
    <!--STYLES END-->
    

    
</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    
        
            
        
    

<header id="header" data-behavior="2">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <div class="header-title">
        <a class="header-title-link" href="/ ">junhee.ko</a>
    </div>
    
        
            <a  class="header-right-picture "
                href="#about">
        
        
            <img class="header-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
        </a>
    
</header>

            <!-- Define author's picture -->



        
    

<nav id="sidebar" data-behavior="2">
    <div class="sidebar-container">
        
            <div class="sidebar-profile">
                <a href="/#about">
                    <img class="sidebar-profile-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
                </a>
                <h4 class="sidebar-profile-name">junhee.ko</h4>
                
                    <h5 class="sidebar-profile-bio"><p>Always Learning</p>
</h5>
                
            </div>
        
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/ "
                            
                            title="Home"
                        >
                    
                        <i class="sidebar-button-icon fa fa-home" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Home</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-categories"
                            
                            title="Categories"
                        >
                    
                        <i class="sidebar-button-icon fa fa-bookmark" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Categories</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link "
                             href="/all-archives"
                            
                            title="Archives"
                        >
                    
                        <i class="sidebar-button-icon fa fa-archive" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Archives</span>
                    </a>
            </li>
            
        </ul>
        
            <ul class="sidebar-buttons">
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://github.com/kojunhee" target="_blank" rel="noopener" title="GitHub">
                    
                        <i class="sidebar-button-icon fab fa-github" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">GitHub</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://facebook.com/kojunheee" target="_blank" rel="noopener" title="Facebook">
                    
                        <i class="sidebar-button-icon fab fa-facebook" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Facebook</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="https://www.linkedin.com/in/junheeko" target="_blank" rel="noopener" title="LinkedIn">
                    
                        <i class="sidebar-button-icon fab fa-linkedin" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">LinkedIn</span>
                    </a>
            </li>
            
                <li class="sidebar-button">
                    
                        <a  class="sidebar-button-link " href="mailto:junheee.ko@gmail.com" target="_blank" rel="noopener" title="Mail">
                    
                        <i class="sidebar-button-icon fa fa-envelope" aria-hidden="true"></i>
                        <span class="sidebar-button-desc">Mail</span>
                    </a>
            </li>
            
        </ul>
        
    </div>
</nav>

            
            <div id="main" data-behavior="2"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title">
            [카프카] 5장_카프카 컨슈머
        </h1>
    
    
        <div class="post-meta">
    <time datetime="2019-12-26T00:00:00+09:00">
	
		    Dec 26, 2019
    	
    </time>
    
        <span>in </span>
        
    <a class="category-link" href="/categories/kafka/">Kafka</a>


    
</div>

    
</div>

    
    <div class="post-content markdown">
        <div class="main-content-wrap">
            <p>컨슈머란, 프로듀서가 메세지를 생산해서 카프카의 토픽으로 보내면 그 토픽의 메세지를 가져와 소비하는 애플리케이션, 서버이다.</p>
<p>주요 기능은, 특정 파티션을 관리하고 있는 파티션 리더에게 메세지를 가져오기 요청을 하는 것이다.</p>
<h3 id="2-콘솔-컨슈머로-메세지-가져오기"><a href="#2-콘솔-컨슈머로-메세지-가져오기" class="headerlink" title="2. 콘솔 컨슈머로 메세지 가져오기"></a>2. 콘솔 컨슈머로 메세지 가져오기</h3><p>컨슈머를 실행할 때는 항상 컨슈머 그룹이 필요하다. </p>
<p>만약 추가 옵션을 주지 않고 실행하면, 자동으로 다음 형태로 컨슈머 그룹이 생성된다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">console-consumer-xxxx(숫자)</span><br></pre></td></tr></table></figure>

<h3 id="4-파티션과-메세지-순서"><a href="#4-파티션과-메세지-순서" class="headerlink" title="4. 파티션과 메세지 순서"></a>4. 파티션과 메세지 순서</h3><h4 id="4-1-파티션-3개로-구성한-토픽과-메세지-순서"><a href="#4-1-파티션-3개로-구성한-토픽과-메세지-순서" class="headerlink" title="4.1 파티션 3개로 구성한 토픽과 메세지 순서"></a>4.1 파티션 3개로 구성한 토픽과 메세지 순서</h4><p>프로듀서 다음 순서로 보낸다.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">b</span><br><span class="line">c</span><br><span class="line">d</span><br><span class="line">e</span><br></pre></td></tr></table></figure>

<p>컨슈머에서 –from-beginning 옵션으로 받는다. </p>
<p>메세지의 순서가 프로듀서가 보낸 순서가 아니다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">d</span><br><span class="line">b</span><br><span class="line">e</span><br><span class="line">c</span><br></pre></td></tr></table></figure>

<p>다음으로, 프로듀서서가 숫자를 보낸다.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<p>컨슈머에서 –from-beginning 옵션으로 받는다. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">d</span><br><span class="line">1</span><br><span class="line">4</span><br><span class="line">b</span><br><span class="line">e</span><br><span class="line">2</span><br><span class="line">5</span><br><span class="line">c</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p>위 현상들은 정상이다.</p>
<p>–partition 0, –partition 1, –partition 3 로 각각 옵션을 주어서 컨슈머를 각각 실행해보면,</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">b</span><br><span class="line">e</span><br><span class="line">2</span><br><span class="line">5</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">d</span><br><span class="line">1</span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">c</span><br><span class="line">3</span><br></pre></td></tr></table></figure>

<p><img src="/image/kafka_partition_message.png" alt></p>
<p>프로듀서가 메세지를 a b c d e 순서로 보냈지만, 해당 메세지들은 하나의 파티션에만 순서대로 저장되는 것이 아니라 각각의 파티션별로 메세지가 저장되었다. </p>
<p>컨슈머의 출력 내용은 각 파티션의 오프셋 순서대로 메세지를 가져온 것이다.</p>
<p>즉, </p>
<ol>
<li>카프카 컨슈머에서의 메세지 순서는 동일한 파티션 내에서는 프로듀서가 생성한 순서와 동일하게 처리하지만, </li>
<li>파티션과 파티션 사이에서는 순서를 보장하지 않는다.</li>
</ol>
<h4 id="4-2-파티션-1개로-구성한-토픽과-메세지-순서"><a href="#4-2-파티션-1개로-구성한-토픽과-메세지-순서" class="headerlink" title="4.2 파티션 1개로 구성한 토픽과 메세지 순서"></a>4.2 파티션 1개로 구성한 토픽과 메세지 순서</h4><p>메세지 순서를 정확하게 보장받기 위해서는 토픽 파티션 수를 1로 지정하면 된다.</p>
<p>단점은, </p>
<ol>
<li>분산해서 처리할 수 없고 </li>
<li>하나의 컨슈머에서만 처리할 수 있기 때문에 처리량이 낮다.</li>
</ol>
<h3 id="5-컨슈머-그룹"><a href="#5-컨슈머-그룹" class="headerlink" title="5. 컨슈머 그룹"></a>5. 컨슈머 그룹</h3><p>동일한 토픽에 대해 여러 컨슈머가 메세지를 가져갈 수 있도록 컨슈머 그룹이라는 기능을 제공한다. </p>
<p>이 방식은, 최근에 하나의 데이터를 다양한 용도로 사용하는 요구가 많아져서 좋다.</p>
<p><img src="/image/kafka_consumer_g01.png" alt></p>
<blockquote>
<p> 위 그림에서, 갑자기 프로듀서가 해당 토픽으로 많은 메세지를 전송한다고 가정해보자. </p>
</blockquote>
<p>프로듀서가 메세지를 보내는 속도가 컨슈머가 메세지를 가져가는 속도보다 빨라서, 컨슈머가 읽어가지 못하는 메세지들이 쌓인다.</p>
<p>그래서 다음과 같이 컨슈머를 확장한다.</p>
<p><img src="/image/kafka_consumer_g02.png" alt></p>
<p>컨슈머 그룹 안에서는 컨슈머들이 메세지를 가져오고 있는 토픽의 파티션에 대한 소유권을 공유한다. </p>
<p>파티션 1 의 소유권이 컨슈머 01 에서 02 로, 파티션 2 의 소유권이 컨슈머 01 에서 03 으로 이동했다.</p>
<p>이렇게 소유권이 이동하는 것을 <code>리밸런스</code> 라고 한다.</p>
<p>리밸런스의 단점은, 리밸런스 하는 동안 일시적으로 컨슈머는 메세지를 가져올 수 없다는 것이다.</p>
<blockquote>
<p>그런데, 이렇게 컨슈머를 추가했음에도 컨슈머가 가져가야하는 메세지가 쌓이면 어떻게 해야할까 ?</p>
</blockquote>
<p>컨슈머 04 를 추가해보자. 그대로다.</p>
<p>왜냐하면, 토픽의 파티션에는 하나의 컨슈머만 연결할 수 있기 때문이다. 각각의 파티션에 대해서는 메세지 순서를 보장하는데 두 개의 컨슈머가 하나의 파티션을 공유하면 안정적으로 메세지 순서를 보장할 수 없다.</p>
<p>그래서 파티션 수도 같이 늘려줘야한다.</p>
<blockquote>
<p> 컨슈머 그룹에서 컨슈머 04 가 다운되는 경우를 살펴보자.</p>
</blockquote>
<p>컨슈머가 컨슈머 그룹 안에서 멤버로 유지하고 할당된 파티션의 소유권을 유지하는 방법은 하트비트를 보내는 것이다. </p>
<p>만약, 커슈머가 오랫동안 하트비트를 보내지 않으면 세션은 타임아웃 되고 해당 커슈머가 다운되었다고 판단해서 리밸런스가 시작된다.</p>
<p>컨슈머 04 가 다운되면서 컨슈머 04 가 담당하던 파티션 3 을 컨슈머 03 이 이어받는다. </p>
<h3 id="6-커밋과-오프셋"><a href="#6-커밋과-오프셋" class="headerlink" title="6. 커밋과 오프셋"></a>6. 커밋과 오프셋</h3><p>컨슈머가 poll() 을 호출할 때마다 컨슈머 그룹은 카프카에 저장되어 있는 아직 읽지 않는 메세지를 가져온다. </p>
<p>이것이 가능한 이유는, 컨슈머 그룹이 어디까지 메세지를 가져갔는지 알 수 있기 때문이다.</p>
<p>컨슈머 그룹의 각각 컨슈머들은 각각의 파티션에 자신이 가져간 메세지의 위치 정보인 오프셋을 기록한다.</p>
<p>각 파티션에 대해 현재 위치를 업데이하는 것을 <code>커밋</code> 이라고 한다.</p>
<ol>
<li><p>올드 카프카 컨슈머 (0.9 이전 버젼)</p>
<p>오프셋 정보를 주키퍼에 저장</p>
</li>
<li><p>뉴 카프카 컨슈머 </p>
<p>내부에서 사용하는 토픽 (_consumer_offsets) 을 만들고 이 토픽에 오프셋 정보를 저장</p>
</li>
</ol>
<h4 id="6-1-자동-커밋"><a href="#6-1-자동-커밋" class="headerlink" title="6.1 자동 커밋"></a>6.1 자동 커밋</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">enable.auto.commit = <span class="keyword">true</span></span><br></pre></td></tr></table></figure>

<p>5초 마다 컨슈머가 poll() 을 호출할 때마다 가장 마지막 오프셋을 커밋한다. </p>
<p><img src="/image/kafka_auto_commit.png" alt></p>
<ol>
<li>컨슈머는 한 번의 poll() 로 메세지를 1, 2 를 가져온다.</li>
<li>5초가 되면서 마지막 오프셋 2 를 커밋한다.</li>
<li>메세지 3 과 4를 가져온다.</li>
<li>5초가 지나 오프셋 4를 커밋한다.</li>
</ol>
<h4 id="6-2-수동-커밋"><a href="#6-2-수동-커밋" class="headerlink" title="6.2 수동 커밋"></a>6.2 수동 커밋</h4><p>메세지 처리가 완료될 때까지 메세지를 가져온 것으로 간주되어서는 안되는 경우에 사용한다. </p>
<p>ex ) 메세지를 컨슈머가 가져오자마자 커밋하는 것이 아니라, 데이터베이스에 메세지를 저장한 후 커밋을 한다.</p>
<h4 id="6-3-특정-파티션-할당"><a href="#6-3-특정-파티션-할당" class="headerlink" title="6.3 특정 파티션 할당"></a>6.3 특정 파티션 할당</h4><p>수동으로 파티션을 할당해 메세지를 가져올 수 있다. </p>
<h4 id="6-4-특정-오프셋부터-메세지-가져오기"><a href="#6-4-특정-오프셋부터-메세지-가져오기" class="headerlink" title="6.4 특정 오프셋부터 메세지 가져오기"></a>6.4 특정 오프셋부터 메세지 가져오기</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">seek(파티션 번호, 오프셋 번호)</span><br></pre></td></tr></table></figure>

<hr>
<p>카프카, 데이터 플랫폼의 최강자 &lt;고승범, 공용준&gt;</p>

            

        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
        
            <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/12/26/kafka-chapter3/" data-tooltip="[카프카] 3장_카프카 디자인" aria-label="PREVIOUS: [카프카] 3장_카프카 디자인">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/12/26/kafka-chapter4/" data-tooltip="[카프카] 4장_카프카 프로듀서" aria-label="NEXT: [카프카] 4장_카프카 프로듀서">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://kojunhee.github.io/2019/12/26/kafka-chapter5/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


        
        
            
                <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
            
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2020 junhee.ko. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="2">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/12/26/kafka-chapter3/" data-tooltip="[카프카] 3장_카프카 디자인" aria-label="PREVIOUS: [카프카] 3장_카프카 디자인">
                
                    <i class="fa fa-angle-left" aria-hidden="true"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PREVIOUS</span>
                </a>
            </li>
            <li class="post-action">
                
                    
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2019/12/26/kafka-chapter4/" data-tooltip="[카프카] 4장_카프카 프로듀서" aria-label="NEXT: [카프카] 4장_카프카 프로듀서">
                
                    <span class="hide-xs hide-sm text-small icon-mr">NEXT</span>
                    <i class="fa fa-angle-right" aria-hidden="true"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions" aria-label="Share this post">
                <i class="fa fa-share-alt" aria-hidden="true"></i>
            </a>
        </li>
        
            
            
            <li class="post-action hide-xs">
                <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://kojunhee.github.io/2019/12/26/kafka-chapter5/" title="Share on Facebook">
                    <i class="fab fa-facebook" aria-hidden="true"></i>
                </a>
            </li>
        
        
            
                <li class="post-action">
                    <a class="post-action-btn btn btn--default" href="#disqus_thread">
                        <i class="fa fa-comment"></i>
                    </a>
                </li>
            
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#" aria-label="Back to top">
            
                <i class="fa fa-list" aria-hidden="true"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="2">
    <i id="btn-close-shareoptions" class="fa fa-times"></i>
    <ul class="share-options">
        
            
            
            <li class="share-option">
                <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https://kojunhee.github.io/2019/12/26/kafka-chapter5/">
                    <i class="fab fa-facebook" aria-hidden="true"></i><span>Share on Facebook</span>
                </a>
            </li>
        
    </ul>
</div>

            
        </div>
        


    
        
    

<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-times"></i>
        </div>
        
            <img id="about-card-picture" src="/assets/images/profile.jpg" alt="Author&#39;s picture"/>
        
            <h4 id="about-card-name">junhee.ko</h4>
        
            <div id="about-card-bio"><p>Always Learning</p>
</div>
        
        
            <div id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                <p>Engineer</p>

            </div>
        
        
            <div id="about-card-location">
                <i class="fa fa-map-marker-alt"></i>
                <br/>
                Incheon
            </div>
        
    </div>
</div>

        
        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
        <!--SCRIPTS-->
<script src="/assets/js/jquery.js"></script>
<script src="/assets/js/jquery.fancybox.js"></script>
<script src="/assets/js/thumbs.js"></script>
<script src="/assets/js/tranquilpeak.js"></script>
<!--SCRIPTS END-->

    
        <script>
             var disqus_config = function () {
                 this.page.url = 'https://kojunhee.github.io/2019/12/26/kafka-chapter5/';
                 
                    this.page.identifier = '2019/12/26/kafka-chapter5/';
                 
             };
            (function() {
                var d = document, s = d.createElement('script');
                var disqus_shortname = 'junheeko';
                s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

                s.setAttribute('data-timestamp', +new Date());
                (d.head || d.body).appendChild(s);
            })();
        </script>
    



    </body>
</html>
